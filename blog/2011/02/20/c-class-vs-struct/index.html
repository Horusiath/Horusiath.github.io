
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>[C#] class vs. struct - Simple Solutions</title>
  <meta name="author" content="Bartosz Sypytkowski">

  
  <meta name="description" content="Dzisiejszy post dotyczyć będzie podstawowych cech języka C#. Mówię tutaj o różnicach występujących pomiędzy strukturami a standardowymi klasami. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Horusiath.github.io/blog/2011/02/20/c-class-vs-struct">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Simple Solutions" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Simple Solutions</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Horusiath.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">[C#] Class vs. Struct</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-20T13:26:00+01:00" pubdate data-updated="true">Feb 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Dzisiejszy post dotyczyć będzie podstawowych cech języka C#. Mówię tutaj o różnicach występujących pomiędzy strukturami a standardowymi klasami. Rzecz była wałkowana już wiele razy, jednak tutaj postaram się zgromadzić i uporządkować tyle informacji, ile znalazłem na ten temat.</p>

<p>Zacznijmy więc od różnic:</p>

<ul>
<li>Klasy bazowe &ndash; jak powszechnie wiadomo wszystkie klasy w C# dziedziczą po typie <strong>Object</strong>. Dotyczy to również struktur, jednak w sposób niebezpośredni. Każda struktura dziedziczy po typie <strong>ValueType</strong>. Warto jednak wiedzieć, że sam <strong>ValueType również dziedziczy po typie Object</strong>.</li>
<li>Dziedziczenie &ndash; wszystkie struktury są niejawnie zapieczętowane (<strong>sealed</strong>). Oznacza to, że nie mogą służyć jako klasy bazowe do dziedziczenia. Dodatkowo same nie mogą dziedziczyć po innych typach. Aby to zrozumieć przedstawię zdezasemblowany nagłówek struktury w języku CIL: <code>.class public sealed MyStruct extends [mscorlib]System.ValueType</code>. Możliwy jest również inny skrótowy zapis:<code>.class public sealed value MyStruct</code></li>
<li>Miejsce w pamięci &ndash; klasy tworzone są na zarządzanej stercie (chociaż można na to wpływać). Struktury tworzone są zawsze na stosie. Wynika stąd, że dostęp do struktur jest szybszy, ale jednocześnie nie powinny one być zbyt duże (stąd jedno z ich określeń jako &ldquo;<em>lekkich klas</em>&rdquo;). Taki stan rzeczy niesie za sobą również inną konsekwencję &ndash; struktury (jak wszystkie typy wartościowe) mają czas życia ograniczony zasięgiem, w którym się zajmują tzn. po wyjściu poza zasięg są one natychmiast usuwane z pamięci (nie trzeba ich odśmiecać).</li>
<li>Przekazywanie &ndash; dochodzimy do momentu przekazywania obiektów jako np. parametrów funkcji. Klasy zawsze przekazywane są przez referencję (tzn. podawany jest wskaźnik na adres bloku pamięci, który jest zajmowany przez obiekt) &ndash; tak więc wszelkie zmiany dokonane na parametrze będą zachowane po wyjściu z funkcji. Struktury są typami przekazywanymi przez wartość (tzn. parametr funkcji będzie w istocie <em>głęboką kopią</em> przekazanej struktury), co za tym idzie zmiany dokonywane na strukturze przekazanej jako parametr nie będą odzwierciedlone w orginale. Nie jest to zawsze porządane zachowanie, dlatego czasami warto oznaczać takie parametry za pomocą słów kluczowych <strong>out</strong> (kiedy chcemy zainicjalizować daną strukturę) oraz <strong>ref</strong>(kiedy wiemy, że struktura ta jest już zainicjalizowana).</li>
</ul>


<p>Powstaje jeszcze jedno ciekawe pytanie: co się stanie w sytuacji, kiedy struktura zawierająca w sobie typ referencyjny zostanie przekazana? Co się wtedy stanie z klasą wewnątrz niej. Odpowiedź brzmi: skopiowana zostanie jedynie referencja na obiekt, będziemy więc mieli do czynienia z <em>płytką kopią</em> obiektu, mimo, że przekazana struktura będzie <em>głęboką kopią</em>.
&ndash; Wartość null &ndash; w przeciwieństwie do klas struktury nie mogą przyjmować wartości null. Dlatego dobrym zwyczajem jest stworzenie statycznego getera zwracającego jakiś odpowiednik pustej struktury. Oczywiście wszystkie typy wartościowe mogą zostać opakowane w typie generyczym Nullable<T> i przyjmować jako takie wartość null (w takim wypadku zawartość naszej stuktury znajduje się pod właściwością Value). Czasami jest to rozwiązanie porządane, a na jego korzyść idzie fakt, że typ ten został wyposażony dość przyjazną programiście konstrukcję:&lt;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">Nullable</span><span class="p">&lt;</span><span class="n">MyStruct</span><span class="p">&gt;</span> <span class="n">p</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyStruct</span><span class="p">();</span>
</span><span class='line'><span class="c1">//prostszy zapis</span>
</span><span class='line'><span class="n">MyStruct</span><span class="p">?</span> <span class="n">p</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyStruct</span><span class="p">();</span>
</span><span class='line'><span class="c1">//lub</span>
</span><span class='line'><span class="n">MyStruct</span><span class="p">?</span> <span class="n">p</span> <span class="p">=</span> <span class="k">default</span><span class="p">(</span><span class="n">MyStruct</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Konstruktory &ndash; struktury zabraniają programiście nadpisywać konstruktor domyślny. Możliwe jest jedynie ustanawianie konstruktorów z parametrami. Ciekawostką jest fakt, że ze struktur można korzystać bezpośrednio po nazwaniu referencji. Jednak wymogiem, który musi być spełniony jest wcześniejsze jawne zainicjalizowanie wszystkich pól składowych struktury. Przykład:
Definicja struktury:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">struct</span> <span class="nc">MyStruct</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">ShowX</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Wykorzystanie:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">MyStruct</span> <span class="n">s</span><span class="p">;</span>
</span><span class='line'><span class="n">s</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>    <span class="c1">//bez tego dostaniemy błąd kompilatora</span>
</span><span class='line'><span class="n">s</span><span class="p">.</span><span class="n">ShowX</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Inicjalizacja pól &ndash; struktury nie mogą inicjalizować początkowych wartości swoich pól. Wpisanie wewnątrz struktury definicji pola w poniższej postaci spowoduje wyrzucenie błędu przez kompilator: <code>
public int y = 1;</code></li>
<li>Metoda Finalize() &ndash; jak wiadomo klasy wykorzystują tą metodę w momencie, kiedy zachodzi ich odśmiecenie. Każda z nich niebezpośrednio przesłania tą metodę. Jednak nie ma to miejsa w przypadku struktur, gdyż nie są one przechowywane na stercie ani nie podlegają kontroli <strong>Garbage Collectora</strong>.</li>
</ul>


<p>Opowiedzieliśmy już o różnicach, czas na to co jest wspólne dla klas i struktur:
&ndash; Zarówno klasy jak i struktury mogą deklarować zmienne statyczne, publiczne, prywatne (struktury nie mogą zawierać pól o dostępie <em>protected</em>) i jak i internal.
&ndash; Klasy i struktury mogą definiować typy generyczne.
&ndash; Mogą implementować interfejsy (mimo, że struktury nie obsługują dziedziczenia, implementacja interfejsów jest możliwa).
&ndash; Mogą przeciążać operatory i definiować stałe.
&ndash; Mogą definiować właściwości i obsługiwać zdarzenia.</p>

<p>Jak widać różnic jest dość sporo, tyle na plus co i na minus. Struktury w C# znacznie się różnią od swoich odpowiedników w C++. Czasami warto się zastanowić nad ich wykorzystaniem w praktyce, gdyż może to poskutkować szybszym działaniem programu. Sądzę, że z tego powodu nie należy ich zawsze spisywać na straty.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bartosz Sypytkowski</span></span>

      








  


<time datetime="2011-02-20T13:26:00+01:00" pubdate data-updated="true">Feb 20<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/dot-net/'>.net</a>, <a class='category' href='/blog/categories/programowanie/'>programowanie</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://Horusiath.github.io/blog/2011/02/20/c-class-vs-struct/" data-via="horusiath" data-counturl="http://Horusiath.github.io/blog/2011/02/20/c-class-vs-struct/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/02/09/typy-anonimowe-metody/" title="Previous Post: Typy anonimowe a metody">&laquo; Typy anonimowe a metody</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/02/25/silverlight-detekcja-krawedzi/" title="Next Post: Silverlight - detekcja krawędzi">Silverlight - detekcja krawędzi &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/12/przenosiny/">Przenosiny</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/20/o-pomykach-i-wnioskach-z-pracy-w-aspnet/">O pomyłkach i wnioskach z pracy w ASP.NET MVC</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/10/servicestack-alternatywa-dla-aspnet/">ServiceStack - alternatywa dla ASP.NET</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/26/garsc-pro-tipow-przydatnych-podczas/">Garść pro tipów przydatnych podczas tworzenia aplikacji</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/16/czego-programisci-net-mogliby-nauczyc/">Czego programiści .NET mogliby nauczyć się od Rubystów?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/horusiath">@horusiath</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'horusiath',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/b.sypytkowski@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Bartosz Sypytkowski -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
