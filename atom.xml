<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Simple Solutions]]></title>
  <link href="http://bartoszsypytkowski.com/atom.xml" rel="self"/>
  <link href="http://bartoszsypytkowski.com/"/>
  <updated>2014-07-05T22:03:42+02:00</updated>
  <id>http://bartoszsypytkowski.com/</id>
  <author>
    <name><![CDATA[Bartosz Sypytkowski]]></name>
    <email><![CDATA[b.sypytkowski@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[FSharp and Akka.net - the functional way]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2014/07/05/fsharp-akka-net/"/>
    <updated>2014-07-05T21:42:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2014/07/05/fsharp-akka-net</id>
    <content type="html"><![CDATA[<p>Actor model is one of the most influential paradigms of dealing with highly concurrent environments in present world. Simplifying, it&rsquo;s based on concept of autonomous thread-safe computation units &ndash; surprisingly called actors &ndash; with no way to directly interfere with each others work. There are no locks or semaphores &ndash; instead of accessing shared resources, they are simply passing messages around &ndash; according to the saying <em>Don&rsquo;t communicate by sharing memory; share memory by communicating</em>.</p>

<p>The first most widespread usage of the actor model was the Erlang Virtual Machine in 1986. While it was for many years closed in it&rsquo;s own niche, programming model itself has been lately forwarded and adopted on the Java Virtual Machine through <a href="http://akka.io/">Akka</a> framework. Until present moment there are actually none mature equivalents on .NET platform. While Microsoft is still developing it&rsquo;s own response in form of <a href="http://research.microsoft.com/en-us/projects/orleans/">Project Orleans</a>, a bunch of developers took the initiative of porting Akka on .NET ground.</p>

<p>I&rsquo;ve decided to try out Akka.NET a little. I&rsquo;ve noticed that it&rsquo;s still a far from completion or production-ready phase, but hopefully since it&rsquo;s based on already existing and mature framework, with help of OSS community missing holes could be patched soon.</p>

<h2>Hello Akka</h2>

<p>You can find an original first step into Akka.NET with F# API <a href="https://github.com/akkadotnet/akka.net/wiki/FSharp-API">here</a>. While I found this sample useful, I&rsquo;ve decided to investigate more about Akka.NET source code and it&rsquo;s F# API. Below you may see my example based on more functional-specific concepts:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">type</span> <span class="nc">ActorMsg</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Greet</span> <span class="k">of</span> <span class="kt">string</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Hi</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">system</span> <span class="o">=</span> <span class="nn">System</span><span class="p">.</span><span class="n">create</span> <span class="s2">&quot;MySystem&quot;</span> <span class="o">&lt;|</span> <span class="nn">ConfigurationFactory</span><span class="p">.</span><span class="nc">Default</span><span class="bp">()</span>
</span><span class='line'><span class="k">let</span> <span class="n">greeter</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">spawn</span> <span class="n">system</span> <span class="s2">&quot;Greeter&quot;</span>
</span><span class='line'>    <span class="o">&lt;|</span> <span class="k">fun</span> <span class="n">mailbox</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="k">let</span> <span class="k">rec</span> <span class="n">loop</span><span class="bp">()</span> <span class="o">=</span> <span class="n">actor</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">let</span><span class="o">!</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="nc">Receive</span><span class="bp">()</span>
</span><span class='line'>            <span class="k">match</span> <span class="n">msg</span> <span class="k">with</span>
</span><span class='line'>            <span class="o">|</span> <span class="nc">Greet</span> <span class="n">name</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Hello %s&quot;</span> <span class="n">name</span>
</span><span class='line'>            <span class="o">|</span> <span class="nc">Hi</span>         <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Hi&quot;</span>
</span><span class='line'>            <span class="k">return</span><span class="o">!</span> <span class="n">loop</span><span class="bp">()</span> <span class="o">}</span>
</span><span class='line'>        <span class="n">loop</span><span class="bp">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">greeter</span> <span class="o">&lt;!</span> <span class="nc">Greet</span> <span class="s2">&quot;Alex&quot;</span>
</span><span class='line'><span class="n">greeter</span> <span class="o">&lt;!</span> <span class="nc">Hi</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here are some explanations:</p>

<ul>
<li>We defined a discriminated union of messages <code>ActorMsg</code>, we want to respond to.</li>
<li>The next step is to create an <code>ActorSystem</code>, analogously to C# and original Scala versions.</li>
<li>We need to define and instantiate an <code>Actor</code>. However unlike the object approach &ndash; which required a custom actor type inheriting from one of the Akka actor classes and defining it&rsquo;s own receiving method &ndash; here we define a tail recursive function, which uses an <code>actor { ... }</code> computation expression instead of actor type declaration.</li>
<li>We pass that function through the lambda to <code>spawn</code> method, which attaches that behavior to our system and returns an <code>ActorRef</code> (not to be confused with Actor instance), assigned to our <code>greeter</code> variable. This way we may refer to actors, and pass messages to them, even if they&rsquo;re not present on our local machine (which is also one of the Akka use cases).</li>
<li>Last two lines are about sending messages to actor references using send operator <code>&lt;!</code>.</li>
</ul>


<p>As you can see, this piece of code is not directly translatable to C# or even Scala API equivalent. It&rsquo;s much more Erlangish. We don&rsquo;t have to define any classes and method overrides. Instead, we have a tail-recursive function. For me this seems more natural approach for F#, since it&rsquo;s more functional-first language, while it&rsquo;s syntax for object oriented programming is very verbose and ugly.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Value absence - why Scala/F# approach is bad?]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2014/07/03/fsharp-and-scala-absent-values/"/>
    <updated>2014-07-03T00:05:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2014/07/03/fsharp-and-scala-absent-values</id>
    <content type="html"><![CDATA[<p>Handling an absent values is one of the most common problems in programming languages. Why we consider this so important? It&rsquo;s because data processing is essential task of every program ever made. And one of the main reasons of systems errors and undefined behaviors are values not present in the system. Most of the modern programming languages tries to aim programmers with solution to handle those cases. Lets look at the most common way of dealing with them:</p>

<ol>
<li><strong>Null pointer reference</strong> &ndash; also called a &ldquo;billion-dollar mistake&rdquo;, introduced by Tony Hoare. It allows to represent an absence of the heap allocated values (objects) in form of pointer referring to not a valid instance of represented type. In most of the mainstream programming languages all heap objects are nullable by default &ndash; no matter if you want it or not.</li>
<li><strong>Option/Maybe type</strong> &ndash; this approach is characteristic for most of the functional languages. Instead of creating null pointer, it defines a special generic type (eg. Option), represented by either one of it&rsquo;s subtypes (Some as wrapper for existing underlying value, or None if value is not present).</li>
</ol>


<p>So why we consider a dedicated Option type a better solution? Because it&rsquo;s explicit, propagates type information about value nullability and &ndash; most of all &ndash; it&rsquo;s non-default. By the most of the time, we expect to have a meaningful references to our data. Their absence is not a desired and certainly should not be an expected behavior. Problem in nullable references is that literally any instance in our code could represent a non-existing value. Analogously to functional approach, all of our objects always represent an Option type.</p>

<p>Currently, after decades on living in shadows, functional paradigm is gaining more and more ground of the field of mainstream programming languages. This also reflects in two of the most popular programming environments, JVM and .NET. Their functional representatives, Scala and F#, claims to combine best of both programming paradigms. This way they also introduced and popularized an Option types among object oriented approach.</p>

<p>But something has been missed along the way, and (in my opinion) both Scala and F# had failed in face of the problem of value absence. Why? Because of their dualism. Since they are functional languages, both of them allows you to create an Option types with full support expected from a functional language. But while they also are object oriented and built on top of object oriented VMs, they allow you to use and create a nullable references. This leads to false sense of security, when using Option types. Lets look at the following example (F#):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">value</span><span class="o">:</span> <span class="nc">String</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="n">doSmthAndReturnString</span><span class="bp">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>How can you be sure that function <code>doSmthAndReturnString</code> won&rsquo;t return a null? Actually you can&rsquo;t until you perform an explicit null check. From the runtime perspective <code>Some null</code> is a perfectly valid record. Does it sound rational? No. So why is this even possible?</p>

<h2>How to combine functional and object oriented worlds?</h2>

<p>From my perspective, the best solution of that problem came with <a href="http://ceylon-lang.org/">Ceylon</a> language. It&rsquo;s based on the concept of <a href="http://ceylon-lang.org/documentation/1.0/tour/types/#union_types">Union Types</a>, one of the key features of Ceylon. For <strong>tl;dr</strong> people &ndash; union type of <code>X|Y</code> is a supertype of both types <code>X</code> and <code>Y</code>. How does it correspond to null/options?</p>

<p>In Ceylon <code>null</code> have it&rsquo;s own unique type <code>Null</code> (just like in Scala). By default all reference types are non-nullable (similarly to functional languages). However they may be nulled if referenced as union type of <code>T|Null</code> (or <code>T?</code> using some syntax suggar). This concept is basically &ndash; however not entirely &ndash; equivalent of Scala <code>Either[T,Null]</code> but without verbose requirement for object wrapping. Moreover, Ceylon compiler is able to optimize this away to standard JVM null references, without any overhead.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="c1">// Scala - Either</span>
</span><span class='line'><span class="n">var</span> <span class="n">m</span><span class="o">:</span> <span class="nc">Either</span><span class="o">[</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Null</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Left</span><span class="o">(</span><span class="s2">&quot;hello&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">var</span> <span class="n">n</span><span class="o">:</span> <span class="nc">Either</span><span class="o">[</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Null</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Right</span><span class="o">(</span><span class="k">null</span><span class="o">)</span>
</span><span class='line'><span class="n">var</span> <span class="n">m</span><span class="o">:</span> <span class="nc">Either</span><span class="o">[</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Null</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Left</span><span class="o">(</span><span class="k">null</span><span class="o">)</span>    <span class="c1">// still valid</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Scala - Option type</span>
</span><span class='line'><span class="n">var</span> <span class="n">m</span><span class="o">:</span> <span class="nc">Option</span><span class="o">[</span><span class="nc">String</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Some</span><span class="o">(</span><span class="s2">&quot;hello&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">var</span> <span class="n">n</span><span class="o">:</span> <span class="nc">Option</span><span class="o">[</span><span class="nc">String</span><span class="o">]</span> <span class="o">=</span> <span class="nc">None</span>
</span><span class='line'><span class="n">var</span> <span class="n">m</span><span class="o">:</span> <span class="nc">Option</span><span class="o">[</span><span class="nc">String</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Some</span><span class="o">(</span><span class="k">null</span><span class="o">)</span>         <span class="c1">// still valid</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Ceylon</span>
</span><span class='line'><span class="nc">String</span><span class="o">|</span><span class="nc">Null</span> <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="o">;</span>    <span class="c1">// no need for value wrapping</span>
</span><span class='line'><span class="nc">String</span><span class="o">?</span> <span class="n">n</span> <span class="o">=</span> <span class="k">null</span><span class="o">;</span>          <span class="c1">// Integer? -&gt; Integer|Null</span>
</span><span class='line'><span class="nc">String</span> <span class="n">f</span> <span class="o">=</span> <span class="k">null</span><span class="o">;</span>          <span class="c1">// compile time error, references are not nullable by default</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see on the example above, this way we combined advantages of safe, explicitly nullable types with verbosity and performance of null referenced types. In my opinion this is a proper, yet still not widespread, solution of one of the most common problem in languages theory.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Things you may not know about CSharp value types]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2014/03/24/things-you-may-not-know-about-csharp-value-types/"/>
    <updated>2014-03-24T22:43:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2014/03/24/things-you-may-not-know-about-csharp-value-types</id>
    <content type="html"><![CDATA[<p>In this post I&rsquo;ll try to deal with few of the myths lying beneath common understanding of how C# structures works in reality. Many of new .NET acolytes are thought about differences between structs and classes. For easier understanding many of those concepts are simplified and therefore doesn&rsquo;t necessary tell all truth about underlying mechanism.</p>

<p>Here are some of them.</p>

<h1>Structs may not be stack allocated</h1>

<p>Think about following example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">struct</span> <span class="nc">MyStruct</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">X</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">Func</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">Example1</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">a</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyStruct</span> <span class="p">{</span> <span class="n">X</span> <span class="p">=</span> <span class="m">3</span> <span class="p">};</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">++</span><span class="n">a</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you remember, one of the well known side effects of stack-allocated values is that they&rsquo;re destroyed automatically, when we leave scope, where they were created. This remains true in .NET environment &ndash; it assures that no more but one value or pointer may be found on top of the stack when returning from method execution.</p>

<p>But what happens, when we execute <code>Example1</code> method and then call lambda returned? <code>a</code> variable as stack allocated structure, should be already destroyed at that moment (it&rsquo;s out of it&rsquo;s creation scope and has not been returned explicitly). But that&rsquo;s not what really happens. Actually .NET environment performs an <strong>escape analysis</strong> to determine if any references to that structure didn&rsquo;t leave it&rsquo;s scope. In that case it would be rather heap allocated in order to prevent premature destruction.</p>

<p>Other known case, when structs become heap allocated values, are allocations of large amounts of memory dedicated to handle values. Since stack memory is very limited (by default it&rsquo;s about 1MB per thread on Windows OS), massive structure allocations would potentially cause a StackOverflowException. What .NET environment does in that case, is fallback to safer heap-based allocations.</p>

<p><em>NOTE</em>: Unfortunatelly at the present moment C# doesn&rsquo;t provide escape analysis to determine if class instances could be stack allocated. Java, even though hasn&rsquo;t got custom value types yet, can provide that feature for specific conditions.</p>

<h1>Struct and class method calls differs significantly</h1>

<p>Next exercise. Think about two types, struct and a class. Both of them have non-static method with identical signature and implementation. When you create instances of both types and call mentioned methods, which call will be faster? If you&rsquo;d thought, that struct method call will be slightly faster, you&rsquo;re right. But why?</p>

<p>Answer lies in low level difference between CIL instructions <code>call</code> and <code>callvirt</code>. Standard class methods use <code>callvirt</code> (name is misleading &ndash; it&rsquo;s used even for non-virtual methods). Since CLR cannot absolutely guarantee, if instance method is overridden or shadowed, it has to perform explicit check by seeking class VTable for function pointer. Actual VTable pointer is one of the internal members of each object. Therefore it requires null check to be performed.</p>

<p>Since struct cannot be null, we don&rsquo;t have to perform null checking. However it&rsquo;s not necessary. Since value types cannot declare or override virtual methods &ndash; struct have fixed inheritance chain &ndash; we don&rsquo;t have to access their VTables. Actually lack of inheritance is so useful, that structure instances don&rsquo;t need to have any pointers to VTable at all. All of these save time necessary to perform a method call.</p>

<p>From that perspective struct method calls are much closer to static methods &ndash; also invoked through <code>call</code> instruction &ndash; than instantiated ones.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[More thoughts on Knockout.js and JavaScript MVVM]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2014/02/20/more-thoughts-on-knockout/"/>
    <updated>2014-02-20T22:47:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2014/02/20/more-thoughts-on-knockout</id>
    <content type="html"><![CDATA[<p>Today I want to share with my reflections on using <a href="http://knockoutjs.com/">Knockout.js</a> and client side MVVM pattern. Some of them refer to my previous post on the same <a href="http://bartoszsypytkowski.com/blog/2013/03/09/knockoutjs-spostrzezenia/">topic</a> (in Polish language). These are my advices to all entusiasts of JavaScipt rich applications, especially to those, who want to try Knockout in production environment.</p>

<h1>Layered structure</h1>

<p>Most of the frontent application logic, I&rsquo;ve got an occasion to look into, was pretty messy. Simple web pages usually are build of chunks of JavaScript code used to bound existing libraries and perform simple logic tasks. Everything is coupled, any kind of logic and DOM manipulations are mixed together. This is the place, where unicorns live and magic happens. But if you&rsquo;re into rich client side applications and frameworks such as Knockout.js, this is not an option. Why?</p>

<p>Knockout.js, AngularJS, Backbone and other MV* frameworks are dedicated to create a web applications. This literaly means, that your client page is an application rather than an ordinary page, rendered only to display the data. There will be probably a <strong>lot</strong> of code and logic bound to HTML on the page. If you will manage your code in unstructurized manner, you&rsquo;ll soon find yourself in spot, where any further changes will the a depressing, time-consuming nightmare.</p>

<p>To be able to manage a large chunks of code, you will need to decouple your JavaScript logic into layers. Beacuse Knockout doesn&rsquo;t provide any application layers off hand, responsibility of creating them lies on you. In rest of the post bellow I want to share my personal experiences developed during many months spent of using Knockout in production environment. Layers described by me can be exactly mapped onto specific patterns/groups of patterns and are described from top to bottom, beginning from layer used for server communication, through data management, HTML page partitioning to core used to bound everything together.</p>

<h2>Gateway</h2>

<p>The main goal of the Gateway object is to abstract server API to look like an ordinary JavaScript function. We would like to call the service in form of <code>usersApi.getUserById(1)</code> rather than cryptic <code>$.post(''api/users', { id: 1 })</code>. In my opinion this is more natural and gives us an easier way for further refactoring. What else can gateways do?</p>

<p>First of all, they should be able to hide necessity of resolution parametrized URLs from view models. They should be able to resolve them or have some helpers attached (think about eqivalent of UrlHelpers, path methods etc.).</p>

<p>In most of the cases I&rsquo;ve met, server communication is done by traditional ajax requests through jQuery ajax or similar calls. Since those functions always returns jQuery promises as a result, you may find that this is not what you want. Maybe you need a more detailed informations or a custom wrapper around promises. Or if you use <a href="https://github.com/Reactive-Extensions/RxJS">RxJS</a>, you probably may want <code>Rx.Observable</code> objects. For all of these cases Gateway is good place to implement.</p>

<p>Gateways could be also used to perform mapping of JSON into fully qualified JavaScript objects you may want to use. This includes things like serializing/deserializing dates, adding additional computed properties, adding/removing recursive dependencies or even changing entire structure of object to beter fit our needs. From Knockout point of view, we can wrap/unwrap objects into ko.observables directly at this layer.</p>

<p>When your data manipulation and mapping logic become more and more complex, consider using a dedicated Factory/Mapper objects to maintain code decoupling.</p>

<h2>Data source</h2>

<p>Data sources (or Data Access Objects) are alternatives to gateways, since they serve similar purpose, but provide much more complex mechanisms. When we speak about data represented on the page, we&rsquo;ll probably see problems associated with incomplete data representation on client side. Paginated tables, autocomplete suggestions, calendar pages, infinite scrolls etc. When used with remote source, all of these use server side requests to get data to be shown to end users. But on large data volumes we never retrieve all of the informations, instead using only those records, which need te be displayed. One of the roles of data sources is to store and manage data received this way, so the next time user goes back to previously displayed page or gets subset of records already provided, we may restore it from the local cache rather than repeating request to the server.</p>

<p>If you want to see a possible ways to implement this pattern, I would recommend you to look at some of the existing implementations, like:</p>

<ul>
<li><a href="https://github.com/twitter/typeahead.js/blob/master/doc/bloodhound.md">Bloodhound</a> suggestion engine for Twitter&rsquo;s <a href="http://twitter.github.io/typeahead.js/">typeahead.js</a> library</li>
<li>Kendo UI <a href="http://docs.telerik.com/kendo-ui/api/framework/datasource">DataSource</a> prototype</li>
<li><a href="http://www.breezejs.com/">Breeze.js</a> framework</li>
<li><a href="http://pouchdb.com/">PouchDB</a>, which is actually full in-browser database with remote sync option</li>
</ul>


<p>All of them provide interesting point of view of what separated data source managers are capable to.</p>

<p>Among other advantages of data source separation we could mention sharing of common data between view models, which should not reference too each other directly, but also managing data objects lifecycle. Fetching data from the server, and synchronizing changes made localy by the client could be done easily this way.</p>

<p>When it comes to data objects, I&rsquo;ve noticed that for purposes of data manipulation on the client side it&rsquo;s nice to have some kind of universal identifiers to manipulate enities. Those identifiers should uniquely identify single entity among all others on the page &ndash; this means, that database identifiers from the JSON object representing server side entities may not be sufficient, since in many cases the records id&rsquo;s (at least when we speak about relational databases with non-UUID primary keys) are guaranted to be unique only in single table/collection scope.</p>

<p>In my case good solution of this problem seems to be an additional object property &ndash; lets call it <code>$id</code> &ndash; which serves only client side logic (server may ignore that value) and it&rsquo;s combination of unique identifier of the entity type and single entity identifier. Since it&rsquo;s called the same among all data objects in client side application, no matter of their type, we may also definie universal comparison operators and function for fetching and data integration. To do so it&rsquo;s also necessary that <code>$id</code> has to be generated in deterministic way &ndash; no matter how many times we create a JavaScript representation of the same database record, it should allways have the same <code>$id</code> value.</p>

<h2>Partial View Models</h2>

<p>Partial view models are used to separate model-view binding in domains of interests. Instead of unorganized bindings of all observed properties to single God Object, remember to use smaller pieces which actually fits a concrete parts of your page &ndash; menus, navbars, forms, modal windows etc.</p>

<p>Don&rsquo;t ever mix a multiple view models in scope of single view component. The only exception from that rule is when you need to manipulate current view model in it&rsquo;s parent context, but even in that case you shouldn&rsquo;t access higher than direct parrent of current VM. If you do, that usually means, something is wrong.</p>

<p>Avoid referencing between view models, especially when they share the same hierarchy level. View models should be an independent units of work. They don&rsquo;t need to know details of other view models to perform requested operations. Use Knockout contexts or dedicated objects as an inter-communication layer and share them between view models, when some message passing is needed.</p>

<p>Don&rsquo;t create large nested objects inside view models. Inject them through constructors instead. Knockout view models lifetime is much longer than AngularJS controllers, but it&rsquo;s still a better solution to share large objects and &ndash; if they come with a lot of logic &ndash; to decouple them from view model. This also includes objects used to communicate with external world.</p>

<h2>Application root</h2>

<p>Since Knockout allows you to use only one View Model as root for whole page, my advice is to create dedicated view model, which won&rsquo;t be used with any visible parts of the page itself. It&rsquo;s role is to serve as a container for actual view models used to display data on the page and to provide universal features to be used by everyone. For me this option remains true even for small ingerention of Knockout logic into the page, because in the world of changing requirements formally small pages may grow rapidly in very short amount of time.</p>

<p>When comes to integration of partial view models and application root, usually it&rsquo;s sufficient to create <strong>all</strong> partial VMs on root level. View models can be nested in large tree structures, but don&rsquo;t overuse this feature. Try to keep your view models dependency scopes as flat as you can. Application root is a good point to handle inner components creation and lifecycle. That also means, it should be able to access and provide all objects &ndash; gateways, data sources, factories, event buses, AJAX handlers etc. &ndash; directly to view models.</p>

<h2>Appendix: Events and Pub/Sub pattern</h2>

<p>There are few more things I wish to present in this post. One of them is a Publish/Subscribe pattern and event processing. It isn&rsquo;t bound to any specific layer since all of them can get advantage of using it. I also found it the best way of dealing with communication between various Knockout view models.</p>

<p>Below I will show one of the simplest implementation used to handling custom events. If you want to be able to use more advanced techniques, you probably want to look for some dedicated libraries such as <a href="https://github.com/Reactive-Extensions/RxJS">RxJS</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">EventStream</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">_channels</span> <span class="o">=</span> <span class="p">{};</span>    <span class="c1">// this could be made private</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// subscribe to channel</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">$on</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channelName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">){</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_channels</span><span class="p">[</span><span class="nx">channelName</span><span class="p">];</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">channel</span><span class="p">)</span>
</span><span class='line'>              <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_channels</span><span class="p">[</span><span class="nx">channelName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>          <span class="nx">channel</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// unsubscribe from channel</span>
</span><span class='line'>  <span class="c1">// this is tricky since anonymous functions, once subscribed cannot be removed</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">$off</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channelName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_channels</span><span class="p">[</span><span class="nx">channelName</span><span class="p">],</span> <span class="nx">i</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">channel</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">callback</span><span class="p">))</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>          <span class="nx">channel</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">channel</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span><span class='line'>              <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_channels</span><span class="p">[</span><span class="nx">channelName</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// publish an event</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">$trigger</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">channelName</span><span class="p">,</span> <span class="nx">event</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_channels</span><span class="p">[</span><span class="nx">channelName</span><span class="p">];</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span>
</span><span class='line'>          <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>              <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                  <span class="nx">channel</span><span class="p">[</span><span class="nx">i</span><span class="p">](</span><span class="nx">event</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span><span class='line'>                  <span class="c1">// an error occurred in subscriber function</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since we have whole event pub/sub feature in one separate prototype, we can now implement it in any object we wish, either through composition or as a mixin. Additionaly we can use globaly shared instances of <code>EventStream</code> in similar fashion we use an event buses. For Knockout applications there is also an alternative in form of <a href="https://github.com/rniemeyer/knockout-postbox">knockout-postbox</a>.</p>

<h1>Final thoughs</h1>

<p>I want to end with a few short advices:</p>

<ul>
<li>All of my observations are based on observations of using Knockout and MVVM in non-SPA paradigm. As I&rsquo;ve said in previous posts, I wouldn&rsquo;t recommend Knockout for creating single page applications, because there are a lot of alternative frameworks, which suits better for this purpose.</li>
<li><a href="https://github.com/Knockout-Contrib/Knockout-Validation">Knockout-validation</a> library &ndash; I&rsquo;ve found it pain in the ass almost everytime, I&rsquo;ve needed to create anything more complex than basic, flat structure validation. There are a lots of problems when it comes to nested objects validation, nullable objects and dealing with validation results caches &ndash; which btw. cannot be accessed via library API. So if you are determined to use it, consider yourself warned.</li>
<li>Use unit tests any time you can. This not only will allow you to catch more potential errors (which are more likely to exist in language such as JavaScript) but are also a nice way to check if your code blocks are properly separated. And better prepare yourself, because client side logic tests are much more difficult to write than their backend cousins.</li>
<li>Create a common prefix for properties used as helper fields and methods, but not directly responsible for view model page manipulations. I&rsquo;ve already shown examples such as <code>$id</code> field and event stream methods with <code>$</code> prefix. I&rsquo;ve found them quite usefull, but I don&rsquo;t want refer to them from view <code>data-bind</code> attributes or server side. They should remain transparent for both of these.</li>
<li>I didn&rsquo;t mention about any kind of Service layer, used for performin business logic. The reason is simple &ndash; unless you&rsquo;re creating SPA with offline editing capabilities, due to reliability and security reasons you probably never wan&rsquo;t to inject a business logic into frontend.</li>
</ul>


<p>And last but not least. There are no universal rules. Form your own point of view, appropriate to your problems.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Top features every statically typed language should have]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2014/02/02/uncommon-static-type-feats/"/>
    <updated>2014-02-02T15:29:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2014/02/02/uncommon-static-type-feats</id>
    <content type="html"><![CDATA[<p>In this post I want to focus on features of statically typed languages which I consider interesting and usefull, but still uncommon and rare among most popular ones in dev environment. First of all, lets try to answer the question: why static typing? We need to realize, what advantages of static typing do we embrace, so we can look for further improvements.</p>

<ol>
<li>Performance &ndash; of course this is first notable difference. Since static typing gives a compiler much more informations about generated program, we have both much heavier optimizations that could be done at compile time and less need of type checking at runtime.</li>
<li>Better tooling &ndash; if our compiler can reason more about our code, so do other tools we use in application development.</li>
<li>Program correctness &ndash; we don&rsquo;t have to be constantly aware of all application functionalities. Because we have expert system in the form of a compiler, we can maintain larger code bases.</li>
</ol>


<p>In scope of this post I want to notice possible features, which may enhance both programmer productivity, application logic correctness and overal code design.</p>

<h2>Type unions and intersections</h2>

<p>Languages: <a href="http://ceylon-lang.org/">Ceylon</a></p>

<p>This feature gives us a profit of union and intersection operations as we know them in set theory, and apply them to types in our language. Type and set theories are very closely related, and they both can benefit with many of common theorems (for example: roots of Hindley-Milner type inference lies in set theory).</p>

<p>Type unions seems to be more natural way to represent some relations, than inheritance. Example: think about type, which could represent all numbers, lets call it <code>Number</code>. From type theory it looks like the best fit would be (literally) union of integer and floating point numbers, which give us a representiation of most of the domain. If this isn&rsquo;t sufficient, it&rsquo;s even easier to extend our Number type with union of more than two types. Now try to do it only by using inheritance or composition&hellip;</p>

<p>Type unions allows us to do the most important thing, most of the non-functional languages do wrong &ndash; proper null handling. In Ceylon <code>Null</code> have it&rsquo;s own type (however it&rsquo;s optimized away during compilation) and is subject to all mentioned rules. All reference variables and field are non-nullable by default &ndash; thanks to unions this behavior could be changed by using notation <code>T|Null</code> or it&rsquo;s simplified form <code>T?</code> for variable type declaration. It&rsquo;s actually a good thing, since this is what we expect from variables in our code for 90% of the time. So why we have to code in continous risk of null exceptions (unless we perform explicit checking), if we may tell compiler to ensure that for us before our code even run? On the other hand, there are a nullable value types, which are also quite usefull at some times. Many languages allow us to use some kind of built-in nullable wrappers, sorrounded with specific compiler magic for programmer convinience (eg. C#). But in my opinion this is not the right way of doing things. If compiler is allowed to use some nice tricks, then we as the programmers also should be able to do so.</p>

<h2>Type constraints / Value dependent types</h2>

<p>Languages: Ada, Eiffel, (experimentally through extensions) all ML-familly languages including Haskell, F*, <a href="http://www.idris-lang.org/">Idris</a></p>

<p>Since we already have a unions and intersections, it would be nice to allow other operations to be performed directly on types. What about conditions?</p>

<p>Lets say I&rsquo;ve got an <code>int</code> type, so I could verify at compile time, that all of the necessary values are restricted to be integers. Ok. Lets go further. What if I want to narrow those integers to omit negative numbers? Actually this is still easy in most of the languages (Java, you have one job&hellip;), since they already have some kind of <code>unsigned int</code> type. But what when I want to go a step further: I want to ensure that my integers are only positive numbers, that means they&rsquo;re neither negatives nor 0. It should be easy, but it&rsquo;s not. Almost all of the languages fail at that moment, requiring programmer to manually check that condition through code at runtime. And this is where type constraints comes to play.</p>

<p>They allow programmer to define specific constraints on values, they refer to. Let me precise this on some pseudocode examples:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>type Positive = x:int where x &gt; 0
</span><span class='line'>type Even = x:int where x % 2 == 0
</span><span class='line'>type IPv4 = x:unsigned byte[] where x.Length == 4</span></code></pre></td></tr></table></div></figure>


<p>So why I consider this nice and usefull? Some languages (eg. C/C++, Go) already offers fixed length arrays, while equivalent the example <code>Even</code> type could be created as specialized class? First of all it&rsquo;s easier, since you have one way to solve multiple problems. It also could be implemented fast (think about implementing and working with custom Even class in language such as Java), which makes it more likely to be used in real life. Next, it&rsquo;s all available at compiler level, when you can actually verify your code before running it and allow compiler for further optimizations. They also could be potentialy empovered when used with type set-like operations described in previous paragraph. And finally refinement types could also be used for implementing Design by Contract principles in your code, which by itself is a nice feature.</p>

<h2>Implicit interfaces</h2>

<p>Languages: <a href="http://golang.org/">Go</a>, <a href="http://www.typescriptlang.org/">TypeScript</a></p>

<p>This one is quite controversial, especially when compared to previously mentioned features. There are many programmers considering implicit interfaces as potentially unsafe, for example by weakening type safety in static typing by creating risk of accidential interface implementation. There are many examples provided to support this thesis, but actually I found most of them is result of bad design decision and broken conventions, or simply explicit interfaces are not solution to presented problems either.</p>

<p>So in what cases implicit interfaces could be usefull:</p>

<ol>
<li>Just like in case of monkey patching it&rsquo;s a way to provide additional features to existing types, that we have no access to. This may be especially usefull to patching holes in stdlib implementations (no matter how hard you try, you never foresee all of them). Example: lack of IParseable interface in .NET common lib.</li>
<li>It makes easier to work with various external libs, minimazing need of constructing adapters to bypass incompatibilities.</li>
<li>It also makes very simple to create mocks.</li>
</ol>


<p>They also encourage some good practices when working with interfaces. Since they&rsquo;re implicit, you will naturally try to keep them as simple and decoupled as possible. It&rsquo;s easy to maintain implementation of interface having dozens of methods, when they are explicit, it&rsquo;s harder to do so in implicit way. And since the purpose of interface is to abstract and describe contract between parts of your application, interfaces with numerous methods are often symphoms of a God Objects in your code. On the other hand it&rsquo;s easier to create a class implementing dozens of interfaces, when they&rsquo;re implicit rather than explicit. This also promotes decoupling.</p>

<h2>Great absent</h2>

<p>Actually I didn&rsquo;t mentioned some of most core features, which benefit all statically typed languages, such as types as first-class citizens, type inference or language macros/templates. The reason of this is, that those thing are well known and more or less present in many of the popular languages we have today. My goal was to describe some potential advantages of powerfull, yet less known features we may see with hope they would be more often met and used in the future.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Przenosiny]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2014/01/12/przenosiny/"/>
    <updated>2014-01-12T23:03:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2014/01/12/przenosiny</id>
    <content type="html"><![CDATA[<p>Od ostatniego posta mino troch czasu, byo to jednak zwizane z ambitnymi zmianami jakie od dawna planowaem wobec bloga. <a href="http://horusiath.blogspot.com">Mj poprzedni blog</a> naprawd dawa si ju we znaki, gwnie przez rozronity i archaiczny silnik, ktry sprawia naprawd sporo kopotw kiedy przychodzio do odrobiny bardziej zaawansowanej konfiguracji.</p>

<p>Chciaem zamieni swojego bloga w co prostego w obsudze, a jednoczenie dajcego moliwoci sporej personalizacji. Po drodze szukaem rnych rozwiza. W praktyce wziem pod uwag 3 z nich:</p>

<ol>
<li>Wordpress &ndash; ta opcja odpada relatywnie szybko, z podobnych przyczyn dla jakich nie lubiem bloggera. Dodatkowym argumentem byy znalezione w Internecie opinie innych programistw, ktrzy okrelali WP jako silnik zbyt rozdmuchany wzgldem swoich nowszych konkurentw.</li>
<li><a href="https://ghost.org/">Ghost</a> &ndash; pocztkowo by to do powany kandydat. Projekt ufundowany przez Kickstarter, w momencie kiedy zwrciem na niego swoj uwag, dobija wanie wersji 0.3.3. Oparty o platform node.js, z do aktywn spoecznoci jak na tak mode rodowisko, gotowym forum dla szukajcych pomocy oraz kilkoma drobniejszymi smaczkami, jak chociaby obsug Markdown jako domylnego formatu pisania postw &ndash; ktrego to i tak uywam przy codziennym pisaniu dokumentw. Niestety we znaki daa si zna jego niedojao, zwaszcza w momencie, gdy musiaem wykorzysta inne ni domylna kompozycje, dorzuci kilka wasnych skryptw, czy postawi cao na <a href="https://www.heroku.com/">heroku</a> (bo wanie takiego hosta zamierzaem uy). Ostatecznie uznaem, e nie potrzebuj wbudowanego edytora z funkcj life preview i do tej pory nie rozumiem dlaczego silnik blogowy &ndash; ktry mona w uproszeniu sprowadzi do generatora statycznych stron WWW &ndash; wymaga obowizkowej bazy danych.</li>
<li><a href="http://octopress.org/">Octopress</a> &ndash; mj ostateczny wybr pad na chyba najprostsz dostpn opcj na rynku. Statyczny generator stron, z domyln obsug formatowania dokumentw w markdown, wietnym wbudowanym kolorowaniem pisowni skryptw, oraz moliwoci update&#8217;w bezporednio z Gita. Do tego hosting bezporednio przez <a href="http://pages.github.com/">Github Pages</a>, bez adnych specjalnych ceremonii, tak jakby byo to dowolne inne repozytorium. adnych baz danych, uwierzytelniania dla strony obsugiwanej przez 1 osob, czy wbudowanych edytorw. Po prostu KISS ;)</li>
</ol>


<h2>Co dalej?</h2>

<p>Postanowiem, e wraz z pozostaymi zmianami zmieni nieco sam ide bloga. O ile przeniosem wikszo starych wpisw, o tyle <strong>chciaem aby wszystkie kolejne posty byy umieszczane po angielsku</strong>. Jest to decyzja ze wzgldw praktycznych &ndash; wikszo programistw (w tym ja), kiedy napotyka jaki problem, nie traci czasu na informacji w polskiej blogosferze, zamiast tego od razu sigajc do anglojzycznych rde. Dodatkowo jest to dla mnie pewnego rodzaju wyzwanie oraz szansa na popracowanie nad jzykiem. Co do pozostaych problemw (statystyki, komentarze, itp.), wiele rzeczy wci czeka na dokoczenie i moe min nieco czasu, eby postawi wszystko na nogi.</p>

<p>Podsumowujc, witam na moim odwieonym blogu w nowej formule.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[O pomykach i wnioskach z pracy w ASP.NET MVC]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/10/20/o-pomykach-i-wnioskach-z-pracy-w-aspnet/"/>
    <updated>2013-10-20T09:49:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/10/20/o-pomykach-i-wnioskach-z-pracy-w-aspnet</id>
    <content type="html"><![CDATA[<p>O wzorcach projektowych w ASP.NET MVC sysza chyba kady. Wikszo z nas przynajmniej raz widziaa jaki filmik instruktaowy bd wideokonferencj promujc stosowanie waciwych wzorcw na tej platformie. Jednake po opanowaniu teorii przychodzi wreszcie pora na to, aby wcieli j w ycie. Co si wtedy okazuje? Bardzo czsto wychodzi na jaw, e zastosowanie poznanych praktyk w prawdziwym yciu sprawia problem, a kolejne miesice programowania w myl jakiej metodyki prowadz do ostatecznej refleksji bdcej zgub programistw: <em>zrobi cokolwiek byle zadziaao</em>.</p>

<p>W tym pocie sprbuj opisa najczstsze bdy, z ktrymi przyszo mi si zmierzy &ndash; rwnie te wynikajce z ogranicze technologii, ale przede wszystkim bdce skutkiem niewaciwego podejcia do problemu.</p>

<h2>Twoja encja  Twj model</h2>

<p>Zasadniczym bdem (lub raczej skrtem mylowym) jest zaoenie, e kada klasa mapowana przez ORM na tabele moe suy jako model przekazywany bezporednio do widoku. Nie znaczy to, e jest to nie moliwe, jednak opcja ta jest z reguy naduywana. Wynika to poniekd ze stylu programowania wyuczonego z tutoriali z cyklu &ldquo;wyklep CRUDa w 5 min.&rdquo;. Pikne i proste, jednak nie majce wiele wsplnego z problemami dnia codziennego. Z drugiej strony jest to wina samego lenistwa programistw oraz przewiadczenia, e faza projektowania z rozpisk architektury chociaby na kartce papieru jest tylko dla kobiet i leszczy ;)</p>

<p>Pytanie brzmi: kiedy naleaoby porzuci modelowanie z encji na rzecz dedykowanych klas POCO? Prawda jest taka, e zaley to od przypadku i wymaga odrobiny dowiadczenia.</p>

<ul>
<li>Jedn z podpowiedzi moe by poziom zagbienia zalenoci. Im jest on gbszy, tym bardziej wykorzystywana przez nas klasa odbiega struktur od modelu wymaganego przez widok. Przykadowo ju 2 poziom zagbienia np. <code>Model.Products.SelectMany(p => p.Orders)</code> moe wiadczy o tym, e dana encja nie jest waciwym kandydatem i powinna zosta zmapowana na dedykowan do tego celu klas.</li>
<li>Innym przykadem moe by sytuacja, w ktrej nasz model wykazuje pewien zwizek z reguami biznesowymi. Przykadowo czstym sposobem reprezentacji okresu czasu powizanego z danym obiektem jest dodanie do modelu dwch pl okrelajcych granice czasowe. W tym momencie pojawia si jednak pewien dysonans midzy definicj biznesow (okres czasu jest pojedynczym obiektem) a rzeczywist implementacj (okres czasu to dwa generyczne pola dat). Jeeli logika biznesowa silnie bazuje na danej definicji np. przedzia czasowy czsto pojawia si w kontekcie wykonywanych operacji, wtedy moliwe, e lepiej byoby wyodrbni j do osobnej klasy.</li>
<li>Jak powszechnie wiadomo, we wspczesnym wiecie aplikacji WWW wymagania klientw s jednymi z najbardziej zmiennych elementw systemu. Moliwo oddzielenia modeli od encji wspiera ten trend, poniewa o ile encje s powizane ze schematem bazy danych (przez co s znacznie mniej podatne na zmiany ze wzgldu na konieczno utrzymania spjnoci z istniejcymi danymi), o tyle modele wykorzystywane przez nas w aplikacji mog by swobodnie modelowane do naszych potrzeb.</li>
</ul>


<h2>Twj ViewData = Twj Model</h2>

<p>W przypadku niektrych frameworkw model jest zdefiniowany w sposb jasny i jednoznaczny. W przypadku ASP.NET MVC nie jest jednak tak atwo, poniewa otrzymujemy tutaj wicej ni jeden sposb dostarczenia danych do widoku. Mowa tu oczywicie o ViewData. Wg. mnie obiekt ten, jakkolwiek przydatny, jest podstawowym zamaniem wzorca MVC w ASP.NET MVC. Dlaczego? Poniewa &nbsp;prawda wyglda tak, e niezalenie od zdefiniowanych przez ciebie klas, prawdziwy model ma zawsze tylko jeden typ: <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.viewdatadictionary(v=vs.108">ViewDataDictionary</a>.aspx).</p>

<p>Czy to le? Niekoniecznie, zaley od przyjtego podejcia. Co z tego wynika? W przypadku modeli zwracanych przez formularze zazwyczaj przyjmuje si, e generyczny model powinien zawiera tylko te dane, ktre zostay wprowadzone przez uytkownika. Tzn. e informacje takie jak opcja wybrana przez uytkownika z listy powinna by czci modelu podczas gdy sama lista dostpnych opcji powinna by przekazywana za porednictwem ViewBag/ViewData. Naturalnie w przypadku, gdy parsujemy model do postaci JSON przekazywanej do klienta, ta zasada nie dotyczy.</p>

<h2>Nic nie znaczce Error Messages</h2>

<p>Jednymi ze gorszych chwil w yciu programisty, s sytuacje, kiedy trzeba obsuy zgoszenie o bdzie w aplikacji. Zdarza si, e zagldamy wtedy do logw (o ile tak informacj zalogowalimy ;) ), aby odnale jakie przydatne informacje, ktre pozwol nam zidentyfikowa natur problemu. Jake wielkie jest rozczarowanie, gdy jedynym hintem jaki wtedy otrzymujemy jest: <code>Object reference not set to an instance of an object.</code> Bardzo rzeczowa i jednoznaczna informacja wrd kilkuset linii kodu wymagajcych zbadania.</p>

<p>Innym cikim przypadkiem jest logowanie niewystarczajcej iloci informacji. Przykad (blok try-catch jest czysto pogldowy):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">try</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="n">productRepository</span><span class="p">.</span><span class="n">GetById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Status</span> <span class="p">!=</span> <span class="n">ProductStatus</span><span class="p">.</span><span class="n">Finished</span><span class="p">)</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidStatusException</span><span class="p">(</span><span class="s">&quot;Provided product has invalid status&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">logger</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Co jest zego w tym przypadku? Wyobramy sobie, e dostajemy zgoszenienie, o bdzie a w logach jedyn informacj jest: <code>Provided product has invalid status</code>. Czy wiemy o jakim statusie mowa? Czy wiemy o jaki produkt chodzi? Nie mamy adnych informacji pozwalajcych zidentyfikowa dany przypadek, mimo e wszystko co potrzebne mamy 2 linijki wyej w kodzie rdowym naszej aplikacji.</p>

<p>Std mj apel: nie bd leniwcem, minuta pracy teraz pozwoli ci zaoszczdzi godziny problemw pniej.</p>

<h2>Too thin controllers, too fat services</h2>

<p><em>Fat models, thin controllers</em> jest zwrotem czsto uywanym w wiecie MVC. Czsto jednak wynikiem utrzymania tej reguy jest zjawisko, ktre sam okrelam jako papierowe kontrolery. Wemy na przykad nastpujc akcj MVC:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="na">[HttpPost]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">ToggleUserBan</span><span class="p">(</span><span class="kt">bool</span> <span class="n">activate</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">ToggleUserBan</span><span class="p">(</span><span class="n">activate</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Na czym polega bd? Prawdopodobnie metoda ToggleUserBan w serwisie jest przypadkiem zbyt szczegowym. Daje to podstawy do przypuszczenia, e architektura aplikacji w ktrym momencie si posypaa. Zajrzyjmy wic do naszego hipotetycznego IUserService:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">interface</span> <span class="n">IUserService</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">ToggleUserBan</span><span class="p">(</span><span class="kt">bool</span> <span class="n">flag</span><span class="p">);</span>
</span><span class='line'>  <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetAllUsers</span><span class="p">();</span>
</span><span class='line'>  <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetActiveUsers</span><span class="p">();</span>
</span><span class='line'>  <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetBannedUsers</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// ...kolejne 70 metod</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Jeeli widzisz taki interfejs, wiedz e co si dzieje. To z czym mamy do czynienia to nic innego, jak zwyke zamiatanie brudu pod dywan. Pseudorozwizanie polegajce na przeniesieniu proceduralnego makaronu w miejsce, w ktre rzadziej si zaglda. Jest to czsty rezultat braku rewizji kodu i testw jednostkowych, oraz samowoli programistw.</p>

<h2>Gar innych porad</h2>

<ul>
<li>unikaj static classes &ndash; utrudniaj one modularyzacj systemu i wprowadzaj twarde powizania, z ktrych bardzo ciko jest potem zrezygnowa. Extension methods s w zasadzie jedynym zastosowaniem dla statycznych klas, dla jakich sam znajduj uytek.</li>
<li>unikaj partial classes &ndash; dopuszczalne tylko w wypadku, gdy rozszerzasz klas generowan przez zewntrzne narzdzia (co swoj drog samo w sobie jest zym pomysem ale o tym moe kiedy indziej ;) )</li>
<li>w przypadku zmiennych uywaj nazw, ktre pozwalaj okreli ich typ i przeznaczenie &ndash; rnego rodzaju skrty oszczdzaj dosownie kilka sekund podczas pisania tylko po to, aby w przyszoci przeduy rozszyfrowywanie kodu przez kogo innego o kilka minut. Pamitaj, e w yciu programisty kod czyta si czciej ni pisze.</li>
<li>podczas zwracania kolekcji zwracaj najmniejszy interface, ktry umoliwia wykonanie zadania &ndash; nie ma sensu wymaga aby argument by list, jeeli jedynym wykonywanym na nim dziaaniem jest foreach</li>
<li>jeeli zwracasz string lub kolekcje nigdy nie zwracaj nulli &ndash; zawsze uywaj string.Empty lub Enumerable.Empty&lt;></li>
<li>nie sprawdzaj czy enumerator jest pusty przy pomocy Count() &ndash; uywaj Any(). W przypadkach kiedy potrzebujesz porwna ilo argumentw w enumeratorze z konkretn liczb np. list.Count() > 3, warto zastanowi si nad uyciem wzorca <a href="http://twistedoakstudios.com/blog/Post4425_counting-iterators-lazily">LazyCounter</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ServiceStack - alternatywa dla ASP.NET]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/08/10/servicestack-alternatywa-dla-aspnet/"/>
    <updated>2013-08-10T20:14:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/08/10/servicestack-alternatywa-dla-aspnet</id>
    <content type="html"><![CDATA[<p>ASP.NET jest wiodc technologi, jeeli idzie o rozwizania webowe w rodowisku .NET. I mimo, e pojcie to samo w sobie nie jest jednolite (w ramach ASP wystpuje wiele oddzielnych technologii), to jednak niewiele syszy si o alternatywach. A jest ich cakiem sporo:</p>

<ul>
<li><a href="http://www.servicestack.net/">ServiceStack</a> &ndash; najbardziej znana alternatywa, o ktrej opowiem wicej w dalszej czci posta.</li>
<li><a href="http://nancyfx.org/">Nancy</a>&ndash; drugi obok ServiceStack, najbardziej znany framework, czerpicy inspiracj ze znanego frameworka Sinatra, napisanego w Rubym.</li>
<li><a href="https://github.com/openrasta/openrasta/wiki/Why-Choose-OpenRasta">OpenRasta</a>&ndash; biblioteka stworzona z myl o tworzeniu API opartego o zasoby.</li>
<li><a href="http://amirrajan.net/Oak/">Oak</a> &ndash; framework mocno zainspirowany dynamik bibliotek Ruby.</li>
<li><a href="http://blog.markrendle.net/2012/06/01/simple-web/">Simple.Web</a> &ndash; micro framework twrcy znanego micro ORMa Simple.Data, ktry umieszczam rwnie w ramach ciekawostki.</li>
</ul>


<p>Sdz, e do niewiele osb syszao te nazwy (zwaszcza ostatnie dwie). Ja jednak postanowiem opowiedzie i zachci do najpopularniejszego z tych rozwiza, czyli ServiceStack.</p>

<p>Co takiego otrzymujemy, decydujc si na jego wykorzystanie?:</p>

<ul>
<li>Cay zestaw <em>extension methods</em> do wbudowanych typw .NET, przyspieszajcych prac programistw.</li>
<li><a href="https://github.com/ServiceStack/ServiceStack/wiki/Auto-mapping">Mechanizm mapowania obiektw</a> &ndash; podobny do AutoMappera, cho prostszy i bardziej ubogi.</li>
<li><a href="https://github.com/ServiceStack/ServiceStack/wiki/Built-in-profiling">Profiler</a> wbudowany w rodowisko.</li>
<li><a href="http://fluentvalidation.codeplex.com/wikipage?title=CreatingAValidator">Zaawansowany mechanizm walidacji</a>, umoliwiajcy m.in. warunkow walidacj poszczeglnych pl.</li>
<li>Mechanizm <a href="https://github.com/ServiceStack/ServiceStack/wiki/Authentication-and-authorization">autentykacji</a> i zarzdzania dostpem oparty o role i uprawnienia z moliwoci logowania poprzez OpenID.</li>
<li><a href="https://github.com/ServiceStack/ServiceStack/wiki/The-IoC-container">Kontener IoC</a> &ndash; rwnie z moliwoci podpicia wasnego.</li>
<li>Minimalistyczny framework ORM (<a href="https://github.com/ServiceStack/ServiceStack.OrmLite">OrmLite</a>) &ndash; umoliwia on podczenie do najpopularniejszych relacyjnych, baz danych. Naturalnie on rwnie moe by zastpiony bardziej kompleksowym rozwizaniem.</li>
<li>Wizania do rzniej maci usug logowania (np. NLog, Elmah, Log4Net, EventLog, Enterprise Lib.) i cache&#8217;owania (np. domylny InMemory, Memcached, Redis, Azure lub Amazon Web Services).</li>
<li>Bundlera plikw JavaScript, CSS, LESS, SASS i CoffeeScript &ndash; chocia trzeba przyzna, e jest to do wyboista droga.</li>
<li>Mechanizm do kolejkowania wiadomoci &ndash; obecnie tylko za porednictwem Redisa. Trwaj prace nad wprowadzeniem bindingw do ZeroMQ, RabbitMQ, Azure Service Bus oraz Amazon SQS.</li>
<li>Gotowe SDK do aplikacji klienckich pod C#, Silverlight, JavaScript oraz Dart.</li>
</ul>


<p>Ale mwic o jego najbardziej kompleksowych zaletach:</p>

<h2>Web services &amp; Content Negotiation</h2>

<p>Jest to &ndash; moim zdaniem &ndash; najciekawsza cecha Service Stack. Tworzc dotychczasowe usugi sieciowe z wykorzystaniem standardowych bibliotek .NET musielimy uzalenia technologi, jak zamierzalimy wykorzysta od formatu danych, jakiego si spodziewalimy. A wic tworzc serwisy wykorzystujce SOAP lub XML tworzylimy dla nich specjalne usugi w WCFie. Jeeli chcielibymy, aby zwracay one dane w postaci JSON, prawdopodobnie wikszo z nas wykorzystaaby najnowsze podejcie w postaci ASP.NET Web API, dla pozostaych formatw ASP.NET.</p>

<p>Problemem takiego podejcia jest fakt, e za kadym z tych rozwiza stoi osobna technologia, ktra nie jest kompatybilna z pozostaymi. Niezalenie od tego, co wybierzemy, nigdy nie otrzymamy kompletnego rozwizania.</p>

<p>Jak wyglda to w przypadku ServiceStack? To proste. Kady z moduw naszej aplikacji moe by zamknity w ramach klas dziedziczcych po wsplnej klasie <code>Service</code>(jednak wbrew pozorom nie mamy tu do czynienia z wzorcem MVC) &ndash; lub w razie potrzeby, ktrej z jej klas bazowych bd interfejsu <code>IService</code>. Kada metoda obsugujca danie pobiera w parametrze obiekt POCO (Plain Old Class Object) i zwraca inny obiekt POCO. Dopiero na poziomie frameworka rozwizywany jest problem serializacji danego obiektu do kocowego formatu, ktry moe by wnioskowany na podstawie nagwka HTTP, zawartoci URL bd dowolnego innego warunku, jaki zdefiniujemy podczas konfiguracji. Rozwizanie to znane jest jako <em>Content Negotiation</em>. Dziki temu jedna klasa moe peni rol kontrolera ASP.NET, WebAPI i serwisu WCF w tym samym czasie!</p>

<p>Domylnie dysponujemy wbudowanymi serializatorami dla formatw: SOAP (1.1 oraz 1.2), XML, JSON, CSV i JSV. Dodatkowo w sieci mona pobra pluginy rozszerzajce t list o niemal wszystkie formatery dostpne w wiecie .NET, w tym te binarne. Jedna linijka kodu w konfiguracji nieraz wystarcza, aby wprowadzi dany format do naszej aplikacji. Warto zauway, e ta sama zasada panuje w przypadku dynamicznie generowanych stron HTML &ndash; po doinstalowaniu pluginu moemy generowa strony w oparciu o skadni Razora oraz Markdown.</p>

<h2>Wydajno</h2>

<p>Twrcy ServiceStack zwracaj szczegln uwag na szybko swojej platformy, w myl powiedzenia: <i>&ldquo;We care about two things: speed and quality. And the quality we care about is speed&rdquo;</i>. Nie powinno wic dziwi, e wikszoci wypadkw framework ten przewysza ASP.NET i WCF w kwestiach wydajnociowych. Wynika to z prostego faktu. Mamy tu do czynienia z inicjatyw open source, a w przedsiwziciach tego typu du rol odgrywa prostota. Nie ma tutaj miejsca na platformy typu Enterprise, z setkami warstw abstrakcji, penymi potworkw typu <a href="http://ws.apache.org/xmlrpc/apidocs/org/apache/xmlrpc/server/RequestProcessorFactoryFactory.RequestSpecificProcessorFactoryFactory.html">RequestSpecificProcessorFactoryFactory</a>(tak, jest to wyraz mojego &ldquo;hejtu&rdquo; wzgldem podejcia projektowego w Javie, ale fakt faktem problem ten dotyka rwnie .NETu ;) ).</p>

<p>Konkretne porwnania i benchmarki mona znale <a href="https://github.com/ServiceStack/ServiceStack/wiki/Real-world-performance">tutaj</a>. I jak wida, nie chodzi tu o jaki pomijalny zysk rzdu kilkunastu procent.</p>

<h2>Testowalno</h2>

<p>ServiceStack jest frameworkiem z natury bardzo zmodularyzowanym, umoliwiajcym wymian poszczeglnych komponentw. To z kolei czyni go naturalnym kandydatem do wprowadzenia testw jednostkowych.</p>

<p>Innym atutem jest podejcie wymiany danych opartych na komunikatach (message-based design), ktre w wypadku ServiceStack s zwykymi klasami POCO. Dziki temu testujc poszczeglne moduy/usugi nie musimy przetwarza wbudowanych we framework obiektw da i odpowiedzi. Zamiast tego mamy do czynienia ze standardowym zbiorem klas, zdefiniowanych przez nas samych, ktre z zewntrz nie zdradzaj zalenoci od uywanego przez nas frameworka. Ponad to architektura sprawia, e najwygodniejszym podejciem jest budowa duej iloci serwisw z ma iloci metod, co dodatkowo uatwia zachowanie ziarnistoci systemu.</p>

<h2>Wieloplatformowo</h2>

<p>Ostatni wart odnotowania cech pozostaje fakt, e wybierajc SS otrzymujemy w peni funkcjonalny framework dziaajcy zarwno pod Windowsem jak i platformami linuxowymi. Wiem, e pod ASP rwnie mona programowa w sposb pozwalajcy na postawienie aplikacji na Linuxie, ale jest to rozwizanie niekompletne. Przykadowo, ServiceStack jest obecnie jedyn opcj pozwalajc na uruchomienie usug SOAP pod Mono.</p>

<p>Nie oznacza to jednak, e decydujc si na SS, musimy rezygnowa z naszej dotychczasowej aplikacji napisanej w ASP.NET. Rwnie dobrze moemy uruchomi hosta ServiceStack wewntrz Global.asax i uywa go np. tylko jako zamiennika warstwy nonej dla usug WCF.</p>

<p>Cao doskonale wpisuje si w natur technologii webowych, ich otwarto i multiplatformowo. Dodatkowo umoliwia ona optymalizacj kosztw (hosting linuxowy jest rednio 5-krotnie taszy ni porwnywalny windowsowy) i otwiera nowe moliwoci na rynku, ktry w przypadku .NET w ogromnej czci skada si z aplikacji biznesowych.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gar pro tipw przydatnych podczas tworzenia aplikacji]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/06/26/garsc-pro-tipow-przydatnych-podczas/"/>
    <updated>2013-06-26T22:49:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/06/26/garsc-pro-tipow-przydatnych-podczas</id>
    <content type="html"><![CDATA[<p>Od jakiego czasu mylaem o zebraniu w gar przemyle zwizanych z rozwojem projektw, bazujc na dowiadczeniach w aplikacjach, przede wszystkim biznesowych, w produkcji ktrych przyszo mi uczestniczy. Poniewa pami jest zawodna i nie wszystko co chciaem wymieni udao mi si spamita i ubra w sowa, by moe w przyszoci bd kontynuowa ten wtek.</p>

<p>Z gry zaznaczam, e tematy takie jak testy jednostkowe czy automatyzacja, celowo zostay tutaj przeze mnie potraktowane marginalnie. Jest tak dlatego, poniewa s one wakowane bez przerwy w wielu artykuach i kady programista powinien si z nimi do tej pory zapozna. Punkty jakie tutaj poruszam mogby dotyczy take tych dziedzin, postanowiem jednak skupi si na odrobin innych aspektach.</p>

<h2>1. &ldquo;Jestemy jedn rodzin, mamy wsplne korzenie&rdquo;</h2>

<p>Naturaln cech aplikacji webowych rozwijanych w ramach rodowiska .NET jest ich podzia na wiele rnych projektw. Nie jest to wymg, jednake z reguy zdecydowanie pomaga w organizacji oraz w trakcie pniejszego wdraania rozwiza. To co jednak uznaem za warte przypomnienia to wzajemne powizania pomidzy projektami. Mwic za dokadniej, przydatno stworzenia wsplnej biblioteki-korzenia, dowizywanej przez wszystkie pozostae projekty w aplikacji.</p>

<p>Ma to kilka prostych przyczyn. Po pierwsze zdaa si, e musimy zaimplementowa pewn funkcjonalno w kilku bibliotekach, bdcych na podobnym poziomie zalenoci, ktrych jednak nie moemy powiza ze sob np. ze wzgldu na rekurencyjne zaptlenie zalenoci &ndash; tutaj wsplny &ldquo;korze&rdquo; okazuje si nieoceniony. Po drugie, w trakcie pracy z aplikacj nieraz powstaje ch stworzenia wasnego DSLa bd zestawu rozszerze upraszczajcych prac z dan platform bd jzykiem. Ile to razy rodzia si ochota na dodanie <em>extension method</em>, ktrej brakuje nam w istniejcych ju klasach .NET? Tutaj rwnie moliwo wspdzielenia tego typu funkcjonalnoci jest bardzo przydatna.</p>

<p>Idea wsplnego &ldquo;korzenia&rdquo; przydaje si rwnie kiedy mowa o klasach wyjtkw. Dobr praktyk w trakcie definiowania aplikacji jest wywoywanie wasnych wyjtkw, ktre mog informowa nie tylko o bdach w operacjach logicznych systemu, lecz rwnie logice biznesowej jako takiej. Moim zdaniem wszystkie takie <em>customowe</em> wyjtki powinny mie wspln klas bazow. Dziki temu w pniejszych fragmentach aplikacji bdziemy mogli bez problemu wychwytywa te z nich, ktre stworzylimy sami na potrzeby naszego systemu i odpowiednio na nie reagowa &ndash; przeksztaa do postaci czytelnej dla kocowego uytkownika, logowa itp.</p>

<h2>2. Atomic frontend design</h2>

<p>Atomic design to koncepcja projektowania elementw HTML w sposb uporzdkowany na bazie kompozytw. Nieraz w yciu codziennym zdarza si nam okrela komponenty strony w do oglny sposb, pozostawiajc szczegy implementacji na &ldquo;doprecyzowanie pniej&rdquo; ;) W rezultacie koczymy w morzu (lub raczej szambie) znacznikw o mglicie oznaczonych brzegach. Poniewa HTML na stronach moe mie bardzo rozronit posta, ktr jako programici te bdziemy musieli utrzymywa, warto zadba te o ten aspekt aplikacji.</p>

<p>Idea atomic designu skupia si wasnie na wizaniu elementw HTML w kompozyty, ktre z kolei s czone ze sob dalej w kolejne, bardziej abstrakcyjne struktury. Wicej szczegw na ten temat moecie dowiedzie si <a href="http://bradfrostweb.com/blog/post/atomic-web-design/">tutaj</a>. W praktyce warto pozna to podejcie ju teraz &ndash; w obecnej chwili wida wyaniajcy si coraz mocniej trend, ktry w przyszoci moe poskutowa nowym standardem umoliwiajcym definiowanie wasnych znacznikw HTML, majcych bezporednie wsparcie ze strony silnika renderujcego.</p>

<p>Chcc wspomc developerw i przygotowa wspczesne aplikacje webowe do nadchodzcych standardw, inynierowie Google&#8217;a stworzyli projekt <a href="http://www.polymer-project.org/">polymer</a> (czerpicy m.in. z koncepcji atomic designu), ktrego zadaniem jest zbudowa odpowiedni platform abstrakcji z istniejcych ju rozwiza: HTML, Javascriptu oraz CSS. Zgodnie z ich przewidywaniami wraz z rozwojem przegldarek funkcje oferowane przez t bibliotek maj w przyszoci zosta zastpione specjalizowanymi, natywnymi odpowiednikami, za zadaniem polymeru jest umoliwi obecnym aplikacjom kompatybilno z dopiero powstajcymi technologiami. Ciekawostka: mimo, e AngularJS stanowi oddzielny projekt, zapowiedziano ju e w kolejnych wersjach bdzie on coraz bardziej integrowany z polymerem.</p>

<h2>3. Stwrz wasn platform abstrakcji&hellip;</h2>

<p>Kolejna kwestia wynika z prostej tendencji uzaleniania logiki aplikacji od wykorzystywanych bibliotek. W praktyce skutkuje to twardym zwizaniem naszego systemu z konkretnymi rozwizaniami &ndash; ktre w przyszoci mog straci wsparcie, okaza si przestarzae lub niewystarczajce do naszych potrzeb. Taka monolityczna budowa nie jest przychylna zmianom, a jak powszechnie wiadomo klienci lubi wpada na nowe pomysu i zmienia swoje zdanie.</p>

<p>Std te idealnym rozwizaniem jest stworzenie klasycznej paszczyzny abstrakcji, cakowicie izolujcej nasz logik biznesow, ktra stanowi jdro kadej aplikacji biznesowej, od zewntrznych platform, realizowanych porednio jako obiekty proxy/adaptery. Pisz idealnym, w praktyce jednak rzadko takie rozwizanie okazuje si w 100% moliwe. Warto jednak powici mu troch uwagi &ndash; rwnie z perspektywy modularyzacji i moliwoci testowania.</p>

<h2>4. &hellip; ale nie przeginaj z warstwami</h2>

<p>Pamitaj, e kada dodatkowa wartwa abstrakcji z jednej strony umoliwia ci podzielenie problemu na prostsze, bardziej oglne definicje (a ludzie z natury lubi pojmowa wiat oglnikowo), z drugiej strony jednak stanowi jednoczenie kolejn barier w optymalizacji.</p>

<p>To co warto przypomnie, to fakt, e tworzenie aplikacji to proces, w ktrym wymagania zmieniaj si w czasie. Produkcja oprogramowania nie jest jednym z konkursw algorytmicznych, gdzie wszelkie bariery i wartoci graniczne s niezmienne i podane z gry. To co dzi wietnie si sprawdza, jutro moe okaza si niewystarczajce.</p>

<p>Wanym czynnikiem jest odpowiednie zdefiniowanie problemu i dobr waciwych wzorcw i rozwiza. Jako programici nieraz generalizujemy pewne problemy tak, aby dao si je rozwiza przy pomocy istniejcych technologii, kosztem rzeczywistej zoonoci caego systemu. Dla zainteresowanych proponuj obeje <a href="http://www.infoq.com/presentations/8-lines-code-refactoring">wykad</a> Grega Younga na ten temat.</p>

<p>Wielowarstwowe aplikacje stanowi pewien problem, kiedy przychodzi do optymalizacji. Nie oznacza to jednak, e budowa z podziaem na warstwy jest za. Jest wygodna z punktu widzenia programisty i projektowania koncepcji rozwiza dla problemw postawionych przed systemem. Z drugiej strony jednak kada aplikacja posiada pewne punkty zapalne &ndash; wymagajce duej wydajnoci &ndash; ktre bd wymaga niestandardowego trakowania, w tym te odejcia od wczeniej przyjtych koncepcji i zwrotu w stron rozwiza bardziej nisko poziomowych. Dobrze, aby aplikacja umoliwiaa pewien sposb na osignicie tego celu bez zaburzania reszty konstrukcji.</p>

<p>Jednym z moliwych kompromisw jest wielopoziomowy caching. Zamiast przebija sie przez kolejne paszczyzny abstrakcji w celu moliwoci operowania na bardziej niskopoziomowych mechanizmach, cache&#8217;ujemy uzykiwane wartoci na poszczeglnych warstwach. Wielopoziomowy cache umoliwia te przyrostowe skalowanie wydajnoci w zalenoci od potrzeb.</p>

<h2>5. Kradnij&hellip;</h2>

<p>&hellip; moc obliczeniow maszyn klienta. Jest to bardzo dobre podejcie, poniewa wykonywanie czci logiki po stronie przegldarki nie do, e odcia serwery, za ktre musimy paci, to dodatkowo stanowi rozwizanie o wiele bardziej skalowalne, poniewa oglna ilo dostpnej mocy obliczeniowej ronie wraz z liczb maszyn wysyajcych dania na serwer. Std te cz oblicze, takich jak renderowanie dynamicznego HTMLa, czy preprocesowanie modelu danych od razu do postaci przystpnej do oblicze po stronie serwera, mona wykonywa bezporednio w przegldarce.</p>

<h2>6. Oszukuj</h2>

<p>Co mam przez to na myli? Po pierwsze powtarzam: cache&#8217;uj dane. W wiecie aplikacji na platformie .NET czsto jest to opcja marginalizowana. W wielu przypadkach dopuszczalne jest, aby uytkownik zobaczy <em>przyblione</em> dane. A co jeeli nie s one aktualne? <em>Keep calm and oj tam oj tam</em> ;)</p>

<p>Problem, z ktrym si te spotkaem, to stosowanie <em>prymitywych</em> cache&#8217;w w miejscach, w ktrych ciko okreli grn granic przyrostu danych. Tak, zwyky .NETowy sownik moe wystarczy w twoim rodowisku developerskim, ale w momencie, gdy za rok dane pompowane do niego na produkcji bd liczone w setkach tysicy (lub wicej) obiektw, wszyscy na wasne oczy zobacz, e wyprodukowae trabanta w cenie porsche. Technologie sprawdzone na polu walki, takie jak Memcache i Redis s tutaj, gotowe ci wesprze. Korzystaj z tej moliwoci.</p>

<p>Po drugie pamitaj o zotej zasadzie &ndash; czego user nie dotknie, tego sercu nie al. Przykad-anegdota: swego czasu aplikacje na urzdzenia Apple byy podawane jako wzr szybko uruchamiajcych si programw. Aplikacja, ktra na innych systemach uruchamiaa si w kilka sekund, na iPhone bya gotowa w uamku tego czasu. Na czym polega sekret? Ot w rzeczywistoci to, co widzia uytkownik, byo w rzeczywistoci zrzutem ekranu z dziaajcej aplikacji, bez jakichkolwiek moliwoci interakcji. Dziki temu uytkownik mia wraenie, e aplikacja uruchamia si niemal natychmiast. W rzeczywistoci, zanim wykona on jakkolwiek akcj w UI, mijao par sekund, w trakcie ktrych program mia czas, aby si zaadowa i podstawi pod &ldquo;zalepk&rdquo; faktyczny interfejs uytkownika.</p>

<p>Licz na to, e lektura ta okazaa si ciekawa i by moe uda mi si w przyszoci opisa dalsze koncepty i przemylenia.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Czego programici .NET mogliby nauczy si od Rubystw?]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/06/16/czego-programisci-net-mogliby-nauczyc/"/>
    <updated>2013-06-16T12:28:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/06/16/czego-programisci-net-mogliby-nauczyc</id>
    <content type="html"><![CDATA[<p>.NET by wybran przeze mnie technologi niemal od pocztku mojej przygody z programowaniem. Uwaam jednak, e programista nie powinien si zamyka w jednej szyfladce i poznawa szerokie spectrum technologii. Porwnywa je i zna wady oraz zalety kadej z nich. Ostatecznie za umie dobra waciw technologi do rozwizania napotykanych problemw &ndash; nie odwrotnie ;)</p>

<p>Std te pytanie w temacie. Czy faktycznie programici .NET mog nauczy si czego ze rodowiska Ruby, jzyka, ktry ostatnimi czasy zbiera niemao batw (gwnie zwizanych z wydajnoci oraz bezpieczestwem jego najpopularniejszej platformy, RoRa)? Ot jak si okazuje cakiem sporo, nawet pomimo ju istniejcego trendu absorbowania do platformy .NET sporej iloci rozwiza napotykanych w konkurencyjnych gaziach. Poniej postaram si wymieni te, ktre moim zdaniem s warte odnotowania.</p>

<h2>1. Przesta polega na swoim IDE</h2>

<p>Nie da si tego ukry &ndash; Visual Studio jest jednym z najlepszych, o ile nie najlepszym IDE, z jakim programista moe mie obecnie przyjemno pracowa. Ma to jednak pewn cen. W pewnym momencie zaczynamy polega na swoim IDE w stopniu wikszym, ni na wasnych umiejtnociach. Co gorsza przenosi si to bezporednio na tworzone biblioteki (przykad&hellip; Entity Framework &ndash; czy kto prbowa kiedy stworzy model edmx bez pomocy wizarda wbudowanego w Visual Studio?). Jeeli nie moesz sprawnie korzysta z biblioteki bez wsparcia swojego IDE, oznacza to, e jest ona zbyt skomplikowana i najzwyczajniej w wiecie zepsuta.</p>

<p>W przypadku Ruby&#8217;ego, narzdzie pracy jest kwesti gustu. Jednake kiedy pierwszy raz przyszo mi pracowa z teamem RoR kade z nich w porwnaniu do Visual Studio wyglda jak notatnik z kolorowaniem skadni. adnego zaawansowanego refactoringu, intellisense, nawigacji midzy plikami w projekcie, generowania buildw. Co byo w tym najzabawniejsze? Po 2 tygodniach wcale mi tego nie brakowao. Przysowiowy notatnik + konsola cakowicie wystarczay do pracy, za narzdzia s skonstruowane tak, aby programista by sobie w stanie poradzi ze wszystkim zaraz po zainstalowaniu interpretera.</p>

<h2>2. Debuger jest opcj, nie obowizkiem</h2>

<p>W wiecie .NET jest to dziwna opinia. Wielu programistw wykorzystuje go jako normalne narzdzie pracy suce sprawdzeniu, czy aplikacja dziaa poprawnie. Dodatkowo sam Visual Studio uatwia takie podejcie. Jako programista Ruby nigdy nie musiaem skorzysta z debuggera &ndash; prawd mwic, nigdy go nie zainstalowaem. Nie oznacza to oczywicie, e kod napisany w Rubym jest zawsze waciwy. Wynika to z innego podejcia. W tym rodowisku standardem jest pisanie unit testw do weryfikacji kadej bardziej zoonej czci systemu. Dziki temu testy w Rubym s domylnym <strong>must have</strong> przy kadym projekcie.</p>

<h2>3. Nie bj si eksperymentowa</h2>

<p>To co najbardziej spodobao mi si we wsppracy z programistami Ruby, to otwarto na nowinki, ch wyprbowania innych podej. Wie si z tym pewne ryzyko, ale rwnie okrelony zysk. Tutaj powstaje pewien problem &ndash; ryzyko w skostniaym wiecie aplikacji biznesowych z reguy jest czym nie do przyjcia. Dodatkowym hamulcem jest tutaj fakt, e wielu starszych programistw ze rodowiska .NET nieprzychylnie patrzy na rozwizania open source (w kocu kogo wtedy pocign do odpowiedzialnoci?) oraz oglnie technologiom spoza kka Microsoftu.</p>

<p>Nie naley ba si zmian. Nawet jeeli ryzyko jest nieakceptowalne w aplikacjach dla klientw zewntrznych, wci moemy wprowadza drobne zmiany dla systemw uywanych wewntrz firmy oraz wyprbowywa tam nowe podejcia. Z jednej strony moe to przeoy si na zysk w przyszoci, z drugiej dziaa to jak magnes na programistw-pasjonatw, a takich nigdy nie ma za wielu, prawda? ;)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PowerShell okiem programisty .NET]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/05/17/powershell-okiem-programisty-net/"/>
    <updated>2013-05-17T21:20:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/05/17/powershell-okiem-programisty-net</id>
    <content type="html"><![CDATA[<p>Artyku ten tworz z do prostego powodu. Wraz z mijajcym czasem w kadym programicie ronie opr oraz lenistwo wobec powtarzalnych czynnoci wykonywanych codziennie w pracy. Std te szukamy sposobw na zautomatyzowanie cho czci z tych zada. PowerShell moe by jednym ze sposobw na osignicie tego celu. Z tego powodu warto lepiej si z nim zapozna.</p>

<p>Zanim zaczn, chc zaznaczy, e nie jestem mistrzem PS. Postanowiem jednak podzieli si swoimi dowiadczeniami z punktu widzenia typowego programisty .NET i w miar zwile pokaza, w jaki sposb przenie niektre z najpopularniejszych operacji wystpujcych w tym wiecie na ich odpowiedniki w PowerShellu. Zaczynajmy.</p>

<p>Rzecz, ktr nieraz warto zrobi przed rozpoczciem waciwej pracy, to uruchomienie PowerShella w trybie administratora. Moemy to zrobi bezporednio z poziomu <strong>cmd.exe</strong> za pomoc komendy:<code>powershell &ldquo;Start-Process powershell -Verb runAs&rdquo;</code>.</p>

<h3>Wypisanie textu na konsol</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nb">Write-Host</span> <span class="s2">&quot;Hello world!&quot;</span>
</span><span class='line'><span class="c"># lub krcej</span>
</span><span class='line'><span class="s2">&quot;Hello world!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Zmienne</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">int</span> <span class="n">a</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">b</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
</span><span class='line'><span class="kt">var</span> <span class="n">a</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="kt">var</span> <span class="n">b</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">$a</span> <span class="p">=</span> <span class="n">1</span>
</span><span class='line'><span class="nv">$b</span> <span class="p">=</span> <span class="n">2</span>
</span><span class='line'><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span> <span class="p">=</span> <span class="n">1</span><span class="p">,</span> <span class="n">2</span>    <span class="c"># Python-like</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Tablice</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">var</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="m">3.14</span> <span class="p">};</span>
</span><span class='line'><span class="kt">var</span> <span class="n">a</span> <span class="p">=</span> <span class="n">array</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
</span><span class='line'><span class="kt">var</span> <span class="n">iter</span> <span class="p">=</span> <span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">$array</span> <span class="p">=</span> <span class="n">1</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">3</span><span class="p">.</span><span class="n">14</span>
</span><span class='line'><span class="nv">$array</span> <span class="p">=</span> <span class="err">@</span><span class="p">(</span><span class="n">1</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">3</span><span class="p">.</span><span class="n">14</span><span class="p">)</span> <span class="c"># jawny zapis</span>
</span><span class='line'><span class="nv">$a</span> <span class="p">=</span> <span class="nv">$array</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
</span><span class='line'><span class="nv">$iter</span> <span class="p">=</span> <span class="p">(</span><span class="n">1</span><span class="p">..</span><span class="n">10</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Sowniki</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">var</span> <span class="n">dictionary</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">string</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">{</span><span class="s">&quot;key 1&quot;</span><span class="p">,</span> <span class="s">&quot;value 1&quot;</span><span class="p">},</span>
</span><span class='line'>  <span class="p">{</span><span class="s">&quot;key 2&quot;</span><span class="p">,</span> <span class="s">&quot;value 2&quot;</span><span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="n">dictionary</span><span class="p">[</span><span class="s">&quot;key 1&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">$dictionary</span> <span class="p">=</span> <span class="err">@</span><span class="p">{</span><span class="s2">&quot;key 1&quot;</span> <span class="p">=</span> <span class="s2">&quot;value 1&quot;</span><span class="err">;</span> <span class="s2">&quot;key 2&quot;</span> <span class="p">=</span> <span class="s2">&quot;value 2&quot;</span><span class="p">}</span>
</span><span class='line'><span class="nv">$dictionary</span><span class="p">[</span><span class="s2">&quot;key 1&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Operatory logiczne, warunkowe i binarne</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">true</span> <span class="p">==</span> <span class="k">true</span>    <span class="c1">// rwny</span>
</span><span class='line'><span class="k">true</span> <span class="p">!=</span> <span class="k">false</span>   <span class="c1">// rny</span>
</span><span class='line'><span class="m">1</span> <span class="p">&gt;</span> <span class="m">0</span>           <span class="c1">// wikszy</span>
</span><span class='line'><span class="m">0</span> <span class="p">&lt;</span> <span class="m">1</span>           <span class="c1">// mniejszy</span>
</span><span class='line'><span class="m">1</span> <span class="p">&gt;=</span> <span class="m">0</span>          <span class="c1">// wikszy lub rwny</span>
</span><span class='line'><span class="m">0</span> <span class="p">&lt;=</span> <span class="m">1</span>          <span class="c1">// mniejszy lub rwny</span>
</span><span class='line'><span class="p">!</span><span class="k">true</span>           <span class="c1">// negacja</span>
</span><span class='line'><span class="k">true</span> <span class="p">&amp;&amp;</span> <span class="k">true</span>    <span class="c1">// koniunkcja (logiczny)</span>
</span><span class='line'><span class="k">true</span> <span class="p">||</span> <span class="k">false</span>   <span class="c1">// alternatywa (logiczny)</span>
</span><span class='line'><span class="m">1</span> <span class="p">^</span> <span class="m">1</span>           <span class="c1">// alternatywa wykluczajca </span>
</span><span class='line'><span class="m">1</span> <span class="p">|</span> <span class="m">1</span>           <span class="c1">// alternatywa (binarny)</span>
</span><span class='line'><span class="m">1</span> <span class="p">&amp;</span> <span class="m">1</span>           <span class="c1">// koniunkcja (binarny)</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">$True</span> <span class="o">-eq</span> <span class="nv">$True</span>    <span class="c"># rwny</span>
</span><span class='line'><span class="nv">$True</span> <span class="o">-ne</span> <span class="nv">$False</span>   <span class="c"># rny</span>
</span><span class='line'><span class="n">1</span> <span class="o">-gt</span> <span class="n">0</span>            <span class="c"># wikszy</span>
</span><span class='line'><span class="n">0</span> <span class="o">-lt</span> <span class="n">1</span>            <span class="c"># mniejszy </span>
</span><span class='line'><span class="n">1</span> <span class="o">-ge</span> <span class="n">0</span>            <span class="c"># wikszy lub rwny</span>
</span><span class='line'><span class="n">0</span> <span class="o">-le</span> <span class="n">1</span>            <span class="c"># mniejszy lub rwny</span>
</span><span class='line'><span class="o">-not</span> <span class="nv">$True</span>         <span class="c"># negacja</span>
</span><span class='line'><span class="nv">$True</span> <span class="o">-and</span> <span class="nv">$True</span>   <span class="c"># koniunkcja (logiczny)</span>
</span><span class='line'><span class="nv">$True</span> <span class="o">-or</span> <span class="nv">$False</span>   <span class="c"># alternatywa (logiczny)</span>
</span><span class='line'><span class="nv">$True</span> <span class="n">-xor</span> <span class="nv">$False</span>  <span class="c"># alternatywa wykluczajca (logiczny)</span>
</span><span class='line'><span class="n">1</span> <span class="o">-bxor</span> <span class="n">2</span>          <span class="c"># alternatywa wykluczajca (binarny)</span>
</span><span class='line'><span class="n">1</span> <span class="o">-bor</span> <span class="n">1</span>           <span class="c"># alternatywa (binarny)</span>
</span><span class='line'><span class="n">1</span> <span class="o">-band</span> <span class="n">1</span>          <span class="c"># koniunkcja (binarny)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Instrukcje warunkowe</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">if</span><span class="p">(</span><span class="err">$</span><span class="n">a</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Statement 1&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="err">$</span><span class="n">b</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Statement 2&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Statement 3&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="k">If</span><span class="p">(</span><span class="nv">$a</span> <span class="o">-eq</span> <span class="nv">$True</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;Statement 1&quot;</span>
</span><span class='line'><span class="p">}</span> <span class="k">ElseIf</span><span class="p">(</span><span class="nv">$b</span> <span class="o">-eq</span> <span class="nv">$True</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;Statement 2&quot;</span>
</span><span class='line'><span class="p">}</span> <span class="k">Else</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;Statement 3&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Ptle</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">element</span> <span class="k">in</span> <span class="n">array</span><span class="p">)</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">element</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">i</span><span class="p">++);</span>
</span><span class='line'>
</span><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">i</span><span class="p">++);</span>
</span><span class='line'><span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="p">=</span><span class="n">1</span><span class="err">;</span> <span class="nv">$i</span> <span class="o">-lt</span> <span class="n">10</span><span class="err">;</span> <span class="nv">$i</span><span class="p">++)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">Write-Host</span> <span class="nv">$i</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">foreach</span><span class="p">(</span><span class="nv">$i</span> <span class="k">in</span> <span class="p">(</span><span class="n">1</span><span class="p">..</span><span class="n">10</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">Write-Host</span> <span class="nv">$i</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="nv">$i</span> <span class="o">-lt</span> <span class="n">10</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">Write-Host</span> <span class="nv">$i</span>
</span><span class='line'>  <span class="nv">$i</span><span class="p">++</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">Write-Host</span> <span class="nv">$i</span>
</span><span class='line'>  <span class="nv">$i</span><span class="p">++</span>
</span><span class='line'><span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nv">$i</span> <span class="o">-lt</span> <span class="n">10</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">Write-Host</span> <span class="nv">$i</span>
</span><span class='line'>  <span class="nv">$i</span><span class="p">++</span>
</span><span class='line'><span class="p">}</span> <span class="k">until</span><span class="p">(</span><span class="nv">$i</span> <span class="o">-eq</span> <span class="n">10</span><span class="p">)</span>   <span class="c"># odpowiednik: do {} while(-not ($i -ne 10))</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Definicje wasnych metod/funkcji</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">// C# wymaga &quot;opakowania funkcji&quot; w klas</span>
</span><span class='line'><span class="k">class</span> <span class="nc">A</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="kt">int</span> <span class="nf">Fib</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="p">=</span> <span class="m">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="p">&lt;</span> <span class="m">2</span><span class="p">)</span> <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nf">Fib</span><span class="p">(</span><span class="n">n</span> <span class="p">-</span> <span class="m">2</span><span class="p">)</span> <span class="p">+</span> <span class="n">Fib</span><span class="p">(</span><span class="n">n</span> <span class="p">-</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">(</span><span class="k">new</span> <span class="n">A</span><span class="p">()).</span><span class="n">Fib</span><span class="p">(</span><span class="m">10</span><span class="p">);</span>    <span class="c1">// wynik: 55</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="k">Function</span> <span class="n">Fib</span><span class="p">(</span><span class="nv">$n</span> <span class="p">=</span> <span class="n">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$n</span> <span class="o">-lt</span> <span class="n">2</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nv">$n</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="n">Fib</span><span class="p">(</span><span class="nv">$n</span> <span class="p">-</span> <span class="n">2</span><span class="p">))</span> <span class="p">+</span> <span class="p">(</span><span class="n">Fib</span><span class="p">(</span><span class="nv">$n</span> <span class="p">-</span> <span class="n">1</span><span class="p">)))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">Fib</span><span class="p">(</span><span class="n">10</span><span class="p">)</span>    <span class="c"># wynik: 55</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Wywoania statycznych klas .NET</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">System</span><span class="p">.</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">&quot;10-01-2012&quot;</span><span class="p">);</span>    <span class="c1">// 1 Padziernika 2012</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="no">[System.DateTime]</span><span class="err">::</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;10-01-2012&quot;</span><span class="p">)</span><span class="err">;</span>   <span class="c"># 1 Padziernika 2012</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Tworzenie nowych obiektw za pomoc konstruktorw</h3>

<p>C#:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">var</span> <span class="n">date</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="m">2012</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>    <span class="c1">// 1 Padziernika 2012</span>
</span></code></pre></td></tr></table></div></figure>


<p>PowerShell (przestrze nazw System jest domylnie zaimportowana):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">$date</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">2012</span><span class="p">,</span> <span class="n">10</span><span class="p">,</span> <span class="n">1</span><span class="p">)</span>   <span class="c"># 1 Padziernika 2012</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Kilka przydatnych cmdletw</h3>

<p>Na koniec chciabym pokaza kilka cmdletw, ktre nieraz uatwiaj prac. Warto zauway, e nieraz cmdlet dostpny jest rwnie poprzez alias (przewanie wicej ni jeden). Niektre z nich zostay tutaj przedstawione.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="s2">&quot;A = {0} hours {1} minutes&quot;</span> <span class="o">-f</span> <span class="n">10</span><span class="p">,</span> <span class="n">20</span>  <span class="c"># odpowiednik string.Format</span>
</span><span class='line'>
</span><span class='line'><span class="c">#tworzenie nowego pliku/katalogu</span>
</span><span class='line'><span class="nb">New-Item</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">new_file</span><span class="p">.</span><span class="n">txt</span> <span class="n">-Type</span> <span class="n">File</span>
</span><span class='line'><span class="nb">New-Item</span> <span class="s2">&quot;c:\directories&quot;</span> <span class="n">-Type</span> <span class="n">Directory</span>
</span><span class='line'><span class="n">ni</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">new</span><span class="p">.</span><span class="n">txt</span> <span class="n">-type</span> <span class="n">file</span> <span class="c"># skrtowy zapis</span>
</span><span class='line'>
</span><span class='line'><span class="c"># kopiujemy wszystkie pliki z c:\files do c:\directories</span>
</span><span class='line'><span class="nb">Copy-Item</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\*</span> <span class="n">c</span><span class="p">\</span><span class="n">directories</span>
</span><span class='line'><span class="n">copy</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\*</span> <span class="n">c</span><span class="p">\</span><span class="n">directories</span>    <span class="c"># skrtowy zapis</span>
</span><span class='line'><span class="n">cp</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\*</span> <span class="n">c</span><span class="p">\</span><span class="n">directories</span>      <span class="c"># skrtowy zapis</span>
</span><span class='line'>
</span><span class='line'><span class="c"># usunicie pliku lub katalogu</span>
</span><span class='line'><span class="nb">Remove-Item</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">new</span><span class="p">.</span><span class="n">txt</span>
</span><span class='line'><span class="n">rm</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">new</span><span class="p">.</span><span class="n">txt</span>    <span class="c"># alternatywa</span>
</span><span class='line'>
</span><span class='line'><span class="c"># przenoszenie plikw lub folderw</span>
</span><span class='line'><span class="nb">Move-Item</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">old</span><span class="p">.</span><span class="n">txt</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files2</span><span class="p">\</span>
</span><span class='line'><span class="n">move</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">old</span><span class="p">.</span><span class="n">txt</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files2</span><span class="p">\</span>    <span class="c"># skrtowy zapis</span>
</span><span class='line'><span class="n">mv</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">old</span><span class="p">.</span><span class="n">txt</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files2</span><span class="p">\</span>      <span class="c"># skrtowy zapis</span>
</span><span class='line'>
</span><span class='line'><span class="c"># pobranie zawartoci pliku</span>
</span><span class='line'><span class="nb">Get-Content</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\</span><span class="n">file</span><span class="p">.</span><span class="n">txt</span>
</span><span class='line'>
</span><span class='line'><span class="c"># wpisanie tekstu do pliku</span>
</span><span class='line'><span class="nb">Set-Content</span> <span class="n">file</span><span class="p">.</span><span class="n">txt</span> <span class="s2">&quot;file content&quot;</span>
</span><span class='line'><span class="s2">&quot;file content&quot;</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">file</span><span class="p">.</span><span class="n">txt</span>
</span><span class='line'>
</span><span class='line'><span class="c"># sprawdzenie istnienia pliku lub folderu pasujcego do podanego wzorca</span>
</span><span class='line'><span class="nb">Test-Path</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">files</span><span class="p">\*.</span><span class="n">txt</span>
</span><span class='line'>
</span><span class='line'><span class="c"># wyszukanie linijki z pliku rdowego, zawierajcego szukan fraz</span>
</span><span class='line'><span class="nb">Get-Content</span> <span class="n">file</span><span class="p">.</span><span class="n">txt</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="s2">&quot;fraza&quot;</span>
</span><span class='line'><span class="c"># zwaraca True, jeeli znaleziono dopasowanie</span>
</span><span class='line'><span class="nb">Get-Content</span> <span class="n">file</span><span class="p">.</span><span class="n">txt</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="s2">&quot;fraza&quot;</span> <span class="n">-quiet</span>
</span><span class='line'><span class="c"># rozrnienie wielkoci liter</span>
</span><span class='line'><span class="nb">Get-Content</span> <span class="n">file</span><span class="p">.</span><span class="n">txt</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="s2">&quot;fraza&quot;</span> <span class="o">-casesensitive</span>
</span><span class='line'>
</span><span class='line'><span class="nb">Get-Date</span>    <span class="c"># pobieramy bierzc dat z zegara systemowego: DateTime.Now</span>
</span><span class='line'><span class="nb">Get-Date</span> <span class="n">-displayhint</span> <span class="n">date</span>   <span class="c"># jak powyej, ale pobieramy sam dat: DateTime.Today</span>
</span><span class='line'><span class="nb">Get-Date</span> <span class="n">-displayhist</span> <span class="n">time</span>   <span class="c"># analogicznie dla czasu</span>
</span><span class='line'>
</span><span class='line'><span class="c"># ustawia zegar systemowy na hh:mm:ss do przodu (w przykadzie 1h10m)</span>
</span><span class='line'><span class="nb">Set-Date</span> <span class="n">-adjust</span> <span class="n">1</span><span class="err">:</span><span class="n">10</span><span class="err">:</span><span class="n">00</span>
</span><span class='line'>
</span><span class='line'><span class="c"># informacje o procesie</span>
</span><span class='line'><span class="nb">Get-Process</span> <span class="n">process1</span><span class="p">,</span> <span class="n">process2</span>    <span class="c"># jawne wyliczenie szukanych nazw</span>
</span><span class='line'><span class="nb">Get-Process</span> <span class="n">proc</span><span class="p">*</span>                 <span class="c"># szukanie wg. wzorca</span>
</span><span class='line'><span class="n">ps</span> <span class="n">proc</span><span class="p">*</span>                          <span class="c"># skrtowy zapis</span>
</span><span class='line'><span class="n">ps</span> <span class="n">proc</span><span class="p">*</span>
</span><span class='line'>
</span><span class='line'><span class="c"># zakocz process(-y)</span>
</span><span class='line'><span class="nb">Stop-Process</span> <span class="n">-processname</span> <span class="k">process</span><span class="p">*</span>   <span class="c"># zakocz procesy o nazwie zgodnej z wzorcem</span>
</span><span class='line'><span class="n">kill</span> <span class="n">3888</span>          <span class="c"># skrtowy zapis, zakocz process o Id rwnym 3888</span>
</span></code></pre></td></tr></table></div></figure>


<p>PS: W niektrych z powyszych komend wykorzystaem jeden z feature&#8217;w PowerShella, ktrego wczeniej nie opisaem &ndash; <strong>pipeline operator</strong>. Jest on reprezentowany przez symbol <code>|</code> i suy do przekazywania wyniku jednej funkcji/polecenia jako wejcia do nastpnej.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Zapowied Ruby 2.1 - generational heap]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/05/14/zapowiedz-ruby-21-generational-heap/"/>
    <updated>2013-05-14T20:02:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/05/14/zapowiedz-ruby-21-generational-heap</id>
    <content type="html"><![CDATA[<p>Nie mino wiele czasu od wydania Ruby&#8217;ego w wersji 2.0, a ju pojawia si ciekawa nowinka &ndash; od wersji 2.1 MRI ma wspiera generacje na zarzdzanej stercie. Bya to dla mnie wiadomo o tyle ciekawsza, e do tej pory sdziem, e nie jest to moliwe bez zerwania kompatybilnoci z niskopoziomowymi rozszerzeniami jzyka C, ktre znajduj si w niektrych bibliotekach &ndash; tymczasem zapewniono, e adna tego typu sytuacja nie bdzie mie miejsca.</p>

<h2>Generacje w Rubym (MRI)</h2>

<p>Jak wic ma wyglda nowy mechanizm GC? Do tej pory wiadomo niewiele, dlatego postaram si podzieli szczegami, ktre udao mi si zebra. Nowy garbage collector nosi nazw <strong>RGenGC</strong> i domylnie bdzie dzieli stert na dwie generacje &ndash; czsto odmiecana przestrze niewielkiego rozmiaru dla obiektw krtkotrwaych (obiekty tworzone w zakresach lokalnych metod czsto kocz tu swj ywot) oraz przestrze obiektw dugotrwaych, awansowanych z pierwszej generacji.</p>

<p>Dotychczasowym problemem bya konieczno zmiany adresw obiektw, zwizana z przenoszeniem obiektu pomidzy generacjami. O ile MRI mogoby ledzi takie &ldquo;ruchome&rdquo; instancje, o tyle rozszerzenia napisane w jzyku C nie s w stanie tego zrobi (wewntrznie referencje na obiekty w Rubym s po prostu zwykymi wskanikami). Jak rozwizano ten problem? Postanowiono podzieli referencje na obiekty na dwie klasy:</p>

<ul>
<li>Lnice (<em>shiny</em>) &ndash; obiekty z takimi referencjami mog by swobodnie ledzone i przenoszone pomidzy generacjami zarzdzanej sterty.</li>
<li>Ciemne (<em>shady</em>) &ndash; w momencie, kiedy jaki obiekt zostanie wykorzystany z poziomu C, zostaje on przypisany do tej klasy. Obiekty tego typu nie mog by przenoszone ani zebrane przez kolektor, dopki s wykorzystywane przez kod niezarzdzany.</li>
</ul>


<p>Przypomina to znane z innych rodowisk mechanizmy wsppracy pomidzy kodem wysoko- i niskopoziomowym (w .NET takie &ldquo;nieprzenaszalne&rdquo; obiekty nosz nazw <em>pinned objects</em>).</p>

<p>Jaki ma to wpyw na wydajno? Dotychczas nie stworzono oficjalnych benchmarkw, nieoficjalnie mwi si o kilku procentowej poprawie wzgldem poprzedniego rozwizania. Naley jednak pamita, e prace wci trwaj i wiele moe si jeszcze zmieni.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[O redundancji w wyraeniach LINQ]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/04/23/o-redundancji-w-wyrazeniach-linq/"/>
    <updated>2013-04-23T21:35:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/04/23/o-redundancji-w-wyrazeniach-linq</id>
    <content type="html"><![CDATA[<p>O tym, czym jest redundacja wie chyba kady programista. Kady z nas wie rwnie, e jest to zjawisko nieporzdane i w wikszoci wypadkw lepiej mu zapobiega. Ten post przeznacz na opis przykadowego zjawiska powtrze w zapytaniach LINQ spotykanego w sytuacjach codziennych oraz prostym i czytelnym ich rozwizaniu, o ktrym nieraz zapominamy.</p>

<h2>Przykad</h2>

<p>Wemy pod uwag nastpujcy przykad &ndash; otrzymalimy dokumentacj, w ktrej opisana jest pewna encja. Moe ona mie nastpujc posta:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Document</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="n">DateTime</span> <span class="n">CreateDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="n">Type</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// .. reszta implementacji</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>W ramach logiki biznesowej wykonywanej na encjach tej klasy stworzone zostao pojcie przeterminowania &ndash; z dalszej czci dokumentacji dowiadujemy si, e za przeterminowane uznajemy te encje, w ktrych data utworzenia jest starsza ni X dni (X moe by dowolne np. ustawione w konfiguracji systemu) za typ przybiera konkretn warto. Bez trudu zawamy wic wyniki za pomoc zapytania:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">var</span> <span class="n">x</span> <span class="p">=</span> <span class="p">..</span> <span class="n">pobieramy</span> <span class="n">X</span>
</span><span class='line'><span class="kt">var</span> <span class="n">documents</span> <span class="p">=</span> <span class="n">DataContext</span><span class="p">.</span><span class="n">Documents</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CreateDate</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">&lt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">&quot;M1&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Niestety w pniejszym czasie sowo &ldquo;przeterminowany&rdquo; pojawia si w tym kontekscie jeszcze kilka razy w rnych miejsach aplikacji. Co robimy? W wikszoci spotkanych przeze mnie przypadkw piszemy klauzul <code>Where(&hellip;)</code> ponownie. Ale czy na pewno?</p>

<h2>Inne podejcie</h2>

<p>Rozwizaniem powyej sytuacji moe by stary dobry <em>monkey patching</em>, reprezentowany w C# przez mechanizm extension methods. Z jego uyciem moglibymy rozwiza ten problem w nastpujcy sposb:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">X</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{...}</span> <span class="p">}</span>
</span><span class='line'><span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'><span class="c1">/// Sowo komentarza od ojca dyrektora.</span>
</span><span class='line'><span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Document</span><span class="p">&gt;</span> <span class="n">Expired</span><span class="p">(</span><span class="k">this</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Document</span><span class="p">&gt;</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">x</span> <span class="p">=</span> <span class="n">X</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">data</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CreateDate</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">&lt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">&quot;M1&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Przykad wykorzystania:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">var</span> <span class="n">expiredDocuments</span> <span class="p">=</span> <span class="n">DataContext</span><span class="p">.</span><span class="n">Documents</span><span class="p">.</span><span class="n">Expired</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>W ten sposb stworzylimy stereotyp, ktry moemy wykorzystywa zawsze w sytuacji kiedy mamy do czynienia z tym konkretnym zachowaniem. Jakie s zalety tego podejcia? Po pierwsze trzymamy si zasady DRY (Don&rsquo;t Repeat Yourself). Po drugie sdz, e taki zapis jest o wiele bardziej czytelny i uatwia pniejsze zrozumienie kontekstu, w jakim wykonywane s zapytania.</p>

<p>Innym sposobem na rozwizanie powyszego problemu jest naturalnie przeniesienie filtru bezporednio do kontekstu danych:<code>var data = DataContext.GetExpiredDocuments();</code>. Na czym jednak polega przewaga monkey patchingu? Po pierwsze nie jestemy twardo zwizani ze rdem danych &ndash; napisany wczeniej stereotyp moe by zastosowany dla dowolnej kolekcji, nawet takiej ktra powstaa w wyniku deserializacji dania HTTP. Po drugie rozwinicie to mona wstawi w dowolnym momencie tworzonego zapytania, z dowolnej encji posiadajce odpowiedni relacj.</p>

<p>W rezultacie otrzymujemy rozwizanie bardziej uniwersalne i podatne na zmiany.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Par sw o HTMLu i CSSie]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/04/21/pare-sow-o-htmlu-i-cssie/"/>
    <updated>2013-04-21T08:45:00+02:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/04/21/pare-sow-o-htmlu-i-cssie</id>
    <content type="html"><![CDATA[<p>W tym pocie postanowiem zebra kilka technologii usprawniajcych zabaw stylami i HTMLem, wykorzystujc Visual Studio 2012 jako narzdzie codziennej pracy. Cz z nich cieszy si ju spor popularnoci w wiecie web developerw innych rodowisk, za w wiecie .NET stawiaj swoje pierwsze kroki.</p>

<p>Zanim zaczn waciw cz postu, chc wszystkim przypomnie o <a href="http://visualstudiogallery.msdn.microsoft.com/6ed4c78f-a23e-49ad-b5fd-369af0c2107f">Web Essentials</a>. Jest to absolutny <em>must have</em> jeeli chodzi o web development w VS2012. Wiele z feature&#8217;w opisywanych przeze mnie dalej jest ju wbudowanych w to rozszerzenie.</p>

<h2>Zen Coding</h2>

<p>Jeeli chodzi o kwestie tworzenia szablonw dynamicznych stron HTML, moemy podzieli programistw na dwie grupy. Pierwsza z nich to szczciarze, mogcy budowa szablonych za pomoc czytelnych, przejystych notacji (np. <a href="http://haml.info/">HAML</a> lub <a href="http://jade-lang.com/">Jade</a>). Druga (czyli reszta ;) ) to osoby zmuszane do osadzania dynamicznego kodu w otoczce pseudo-HTML. Z myl o tej drugiej grupie powsta standard znany powszechnie jako Zen Coding. O co w nim chodzi? Zamy, e chcielibymy stworzy kod HTML w nastpujcej postaci:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;p&gt;</span>Menu<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;menu&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nie jestem chyba jedyn osob, ktra uwaa, e pisanie czego takiego z palca to strata czasu? Z pomoc ZenCoding moemy to uproci do nastpujcej postaci:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>#container&gt;p{Menu}+ul.menu&gt;(li&gt;a)*5
</span></code></pre></td></tr></table></div></figure>


<p>W przypadku Web Essentials dla VS2012 jedyne co musimy zrobi, to umieci takie wyraenie w nowej linii oraz nacisn Tab (natychmiast po kocu wyraenia bez spacji), aby wygenerowa wynikowy HTML.</p>

<h2>Prekompilowany CSS</h2>

<p>Do niedawna bya to jeszcze nowinka. Jednake zalety notacji takich jak <a href="http://lesscss.org/">LESS</a> czy <a href="http://sass-lang.com/">SASS</a> szybko zapewniy im waciwe miejsce. Zastanwmy si, dlaczego warto z nich korzysta?</p>

<ul>
<li>Przyswajalno &ndash; e nauka nowej notacji zajmuje kilka godzin/dni.</li>
<li>Usunicie powtarzalnoci kodu &ndash; stosujc zmienne, wartoci wyliczane oraz zagbione style, mozemy osign nasz cel szybciej oraz bez koniecznoci kopiowania tych samych linijek. W dodatku powstay w ten sposb kod jest bardziej podatny na zmiany ni jego statyczny odpowiednik.</li>
<li>Hierarchizacja &ndash; stosowanie importw jest kolejnym krokiem usuwajacym powtarzalny kod, jak rwnie umoliwia podzia kodu CSS na konkretne jednostki odpowiedzialnoci. Pozwala rwnie w pewnym stopniu usun konieczno czenia plikw CSS za pomoc bundlerw.</li>
<li>Rozmiar &ndash; narzdzia takie jak Web Essentials automatycznie kompiluj pliki .less do kodu CSS podczas zapisu zmian w pliku. Dodatkowo s w stanie skompilowa je osobno do postaci z wciciami (czytelnej dla developera) oraz zminimalizowanej (pozbawionej biaych znakw) &ndash; doskonaej do zastosowania w rodowisku produkcyjnym.</li>
</ul>


<p>W skrcie pozwala nam wprowadzi odrobin porzdku i organizacji w dziedzin, ktra do tej pory jest powszechnie uwaana za mudn, powtarzaln i chaotyczn.</p>

<h2>Palety barw</h2>

<p>Nie ma co ukrywa. Programista nie jest artyst-grafikiem i nie powinno si oczekiwa od niego estetyki i twrczoci na poziomie zawodowego designera. Czasem jednak okazuje si, e gotowy layout wykorzystywany na naszej stronie jest niewystarczajcy i musimy skombinowa na szybko &ldquo;co wasnego&rdquo;, czy to w formie dodatkowego stylu czy motywu do odznaczenia czci strony.</p>

<p>W takim wypadku z pomoc przychodzi <a href="https://kuler.adobe.com/">Adobe Kuler</a>. Umoliwia on dostosowanie istniejcego lub zdefiniowanie wasnego motywu kolorystycznego do wykorzystania na stronie zgodnie z powszechnymi reguami rzdzcymi zasadami kompozycji barw.</p>

<h2>CSS &ndash; czy wiesz z czego korzystasz?</h2>

<p>Czy tworzc plik CSS zastanawialicie si, jak dua cz opisanych przez was regu faktycznie jest wykorzystywana na stronie? Chrome umoliwia sprawdzenie tego w do prosty sposb. Wystarczy z poziomu Developer Tools uruchomi Audyt na zakadce o tej samej nazwie. Po kilku sekundach jestemy w stanie zauway co w ten dese:</p>

<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-eBhklZN4A_g/UXL2pqSMowI/AAAAAAAAAHQ/ztKUIviVimU/s1600/chrome-devtool.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="150" src="http://4.bp.blogspot.com/-eBhklZN4A_g/UXL2pqSMowI/AAAAAAAAAHQ/ztKUIviVimU/s320/chrome-devtool.jpg" width="320" /></a></div>


<p>Jaki wynik osigacie na swojej stronie? ;) Powiem szczerze, e wykorzystywanie okoo 40% doczonych regu mona uzna za wysoki wynik.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Niska wydajno Ruby'ego - studium porwnawcze]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/03/20/niska-wydajnosc-rubyego-studium/"/>
    <updated>2013-03-20T23:42:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/03/20/niska-wydajnosc-rubyego-studium</id>
    <content type="html"><![CDATA[<p>We wspczesnym wiecie aplikacji webowych Ruby oraz jego gwna (czsto utosamiana z nim) platforma, Ruby on Rails, s przykadem wietnego dopasowania jzyka do zbioru metodyk i stosu technologicznego nastawionego na maksymalizacj wydajnoci pracy programisty. Stanowi one &ldquo;wylgarni&rdquo; nowatorskich praktyk, ktre nieraz przenikaj dalej i zostaj zaadaptowane przez inne rodowiska. Wystarczy poda kilka przykadw ze rodowiska .NET: migracje w najnowszym EF4.3+, kierunek w jakim zmierza cay ASP.NET MVC czy dynamizacja jzyka C# &ndash; mylelicie, e idea stojca za LINQ to nowatorski pomys? ;) .</p>

<p>Niestety za kaym razem, kiedy mowa o Rubym, powracaj kwestie jego wydajnoci. Jest to pita achillesowa tego jzyka, powtarzana jak mantra w kolejnych dyskusjach programistw. Na czym jednak polegaj te problemy? W tym postcie postaram si je opisa (w odniesieniu do najpopularniejszego kompilatora Ruby&#8217;ego &ndash; MRI) oraz opowiedzie o rozwizaniach, jakie zostay zaadaptowane w innych jzykach. Poniewa moje obserwacje bd porwnywa do innych implementacji, w tym Javy, C#, Pythona i rnych wirtualnych maszyn JavaScriptu, licz e kady bdzie mg wynie z tego jak przydatn wiedz.</p>

<h2>Garbage Collector</h2>

<p>Ten wtek musia si tu pojawi, dlatego te postanowiem zacz wanie od niego. Rozdzia ten bdzie do trudny do przeknicia dla osb, ktre z teori stojc za jzykami programowania nigdy nie miay do czynienia. Zanim przejd one dalej, proponuj zaznajomi si z <a href="http://en.wikipedia.org/wiki/Garbage_collection_(computer_science">tym wpisem</a>) na Wikipedii.</p>

<p>W duym skrcie, Garbage collector w MRI wykorzystuje (podobnie jak wszystkie najpopularniejsze wspczenie maszyny wirtualne) algorytm <em>mark and sweep</em>. Jest to jednak pojcie bardzo szerokie. Zagbiajc si w detale, dochodzimy do pewnych rnic.</p>

<h3>Podzia zarzdzanego stosu</h3>

<p>Wikszo programistw Javy i .NET zapewne kojarzy, e zarzdzana sterta wystpujca w tych jzykach nie jest struktur jednolit, lecz jest podzielona na wiele przestrzeni (mowa tu o generacjach, ale nie tylko). I tak w przypadku .NET &ndash; na przykadzie SGena uywanego w Mono, a wietnie opisanego <a href="http://www.mono-project.com/Generational_GC">tutaj</a> mamy do czynienia z podziaem sterty na kilka zbiorw:</p>

<ul>
<li><strong>Generacje</strong> &ndash; Zazwyczaj istniej dwie lub wicej. Pierwsz jest <strong>obek</strong> (<em>nursery</em>). Ten zbir jest relatywnie may (domylnie 4MB dla SGena, &frac12; pamici cache L2 dla Pythona made by PyPy) i czsto czyszczony. Jest sprawny gwnie ze wzgldu na fakt, e wikszo obiektw przechowywanych na stercie ma stosunkowo krtki czas istnienia (np. zmienne lokalne funkcji/metod, ktre s niepotrzebne poza zakresem danej metody). Obiekty bardziej dugowieczne przenoszone s na sterty kolejnych generacji. W rezultacie pami jest czyszczona czciej, jednak liczy si tutaj rozmiar przeszukiwanej pamici (obek jest may, przez co jego znakowanie i czyszczenie trwa bardzo krtko).</li>
<li><strong>Przestrze duych obiektw</strong> &ndash; poniewa naprawd due obiekty s do cikie do alokacji (znalezienie na stercie jednolitego bloku pamici nie zajtego przez inne obiekty moe by wyzwaniem), s one rozpatrywane osobno, zarwno na wirtualnych maszynach Javy jak i .NETu (tak w przypadku Mono jak i M$).</li>
<li><strong>acuchy znakw (string)</strong> &ndash; tekst jest rwnie traktowany w specjalny sposb. Przykadowo wpisujc w dwch rnych miejscach w kodzie <em>&ldquo;ala ma kota&rdquo;</em> w praktyce definiujemy ten acuch znakw tylko raz, tworzc do niego dwie referencje. Ta zasada dotyczy zarwno Javy, .NETu, Pythona oraz najnowszych silnikw JavaScriptu. Ruby nie implementuje tej funkcjonalnoci &ndash; moim zdaniem na przeszkodzie stoi tutaj natura stringw w tym jzyku, ktre zgodnie ze specyfikacj mog by mutowalne.</li>
</ul>


<p>Niestety w Rubym brakuje podziau sterty na generacje, przez co jest ona byskawicznie zapychana obiektami o krtkim czasie ycia, za &ldquo;sprztnicie&rdquo; caej sterty zajmuje sporo czasu. W chwili obecnej nie jest to moliwe, poniewa GC w MRI nie implementuje przenoszenia obiektw wewntrz sterty (dlaczego tak jest opowiem dalej).</p>

<h3>Co znajduje si na stosie</h3>

<p>W przypadku <strong>Javy</strong> sprawa podziau alokacji pomidzy stos i stert wyglda stosunkowo prosto: typy natywne i referencje na obiekty lduj na stosie, a reszta (obiekty klas) na stert. W przypadku <strong>C#</strong> jest to troch bardziej skomplikowane, poniewa na stosie mog wyldowa rwnie obiekty-struktury (<em>struct</em>) oraz obiekty utworzone za pomoc sowa kluczowego <strong>stackallock</strong>.</p>

<p>Pomidzy GC Javy (oraz javascriptowym V8) a Mono istnieje dodatkowa rnica: dwa pierwsze stosuj tzw. precyzyjne wskaniki, tzn. podczas przechodzenia po stosie przez marker (uruchamiany przez GC w pierwszej fazie pracy i sucy oznaczeniu obiektw, ktre trzeba sprztn) natrafiajc na wartoci od razu wie, czy s one wartociami czy referencjami na obiekty znajdujce si na stercie. Przykadowo maszyna wirtualna JavaScriptu z Chroma uywa do tego specjalnego bitu okrelajcego czy dana warto jest referencj (std na V8 w wersji 32-bitowej liczby cakowite s wewntrznie skadowane jako wartoci <em>31-bitowe</em>). Niestety SGen Mono musi za kadym razem sprawdzi (a w razie wtpliwoci zaoy z gry), czy taka warto wskazuje adres na stercie.</p>

<p>W przypadku Ruby&#8217;ego sprawa wyglda czciowo prociej: w tym jzyku nie istniej typy wartociowe, zatem wszystkie wartoci (w tym liczby oraz flagi logiczne) s reprezentowane przez obiekty skadowane na zarzdzanej stercie. To sprawia, e czas dostpu do nich jest duszy.</p>

<p>Inna niespodzianka, jak szykuje nam Ruby, siga jeszcze dalej. Interpreter MRI (do nadejcia wersji 1.9) konstruowa kod Ruby&#8217;ego przez poredni translacj do <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">drzewa AST</a>. Jednake chcc zapewni programistom &ldquo;peni wadzy&rdquo; nad kodem, tak stworzone drzewo byo skadowane w postaci struktur Ruby&#8217;ego na jego zarzdzanej stercie! Oznacza to, e cay aktualnie wykonywany kod jest reprezentowany przez faktycznie istniejce drzewo obiektw, zajmujce ogromn ilo pamici.</p>

<h3>Jak zarzdzana jest sterta: .NET Mono</h3>

<p>Kolejne zestawienie z Mono. Mwic do oglnie sterta jest podzielona na tak zwane bloki, one z kolei na sloty. Podczas oznaczania obiektw na stercie dzielimy je na 3 typy:</p>

<ul>
<li><strong>Root objects</strong> &ndash; s to obiekty, do ktrych znaleziono referencje na stosie i ktre nie powinny zosta usunite.</li>
<li><strong>Garbage </strong>&ndash; a zatem obiekty-mieci oraz puste przestrzenie, ktre mog zosta realokowane pod nowe obiekty.</li>
<li><strong>Pinned objects</strong> &ndash; specjalny rodzaj tzw. przypitych obiektw. S to obszary pamici wyjte spoza kontroli zarzdzanej sterty, a wic np. struktury z jzyka C, na ktre mamy referencje z poziomu P/Invoke oraz obiekty przypite rcznie w zakresach <strong>unsafe</strong> (za pomoc sowa kluczowego <strong>fixed</strong>). W Mono do tej listy dochodz rwnie te adresy, ktre zostay znalezione na stosie, ale nie koniecznie wskazuj na obiekty. Ze wzgldw bezpieczestwa takich obiektw nie mona odmieca.</li>
</ul>


<p>Z punktu widzenia Garbage Collectora najbardziej upierdliwe s pinned objects. Dlaczego? Ot w trakcie odmiecania pamici GC zostawia &ldquo;dziury&rdquo; pustych przestrzeni, ktre mog posuy w przyszoci do zaalokowania nowych obiektw. Niestety te dziury powoduj fragmentacj pamici. Co z tego, e mamy 10 luk po 100 bajtw, jeeli potrzebujemy stworzy obiekt rozmiaru 200B? Dlatego te GC w Mono zosta wyposaony w opcj realokacji obiektw &ndash; umoliwia to przesunicie pooenia obiektw w pamici tak, aby zczy luki powstae po odmiecaniu w 1 cigy blok w pamici.</p>

<h3>Jak zarzdzana jest sterta: Ruby</h3>

<p>Z punktu widzenia MRI sterta rwnie jest podzielona na komrki, ktre s reprezentowane w pamici jako zwyke struktury C (dokadna nazwa to <em>struct VALUE</em>).</p>

<p>Ciekawostk jest sposb znajdowania pustych fragmentw na stercie sucych pod przysze alokacje obiektw. Do wersji 2.0 (a wic we wszystkich obecnie uywanych) mamy do czynienia ze struktur przyjmujc posta linked listy. Szukajc nieuywanych komrek musielimy przeglda kolejne wzy z listy i sprawdza ich zajto &ndash; przeskakiwanie po pamici oraz znalezienie odpowiednio duego cigego bloku moe by czasochonne, sama lista rwnie ma swj rozmiar. Od wersji 2.0 zamieniono j inn struktur &ndash; bitmap. Od teraz za kadym razem, kiedy tworzona jest zarzdzana sterta, cz pamici na jej pocztku zostaje zarezerwowana na potrzeby bitmapy. Okrela ona w prosty sposb (ustawiajc lub zerujc kolejne bity w pamici) zajto kolejnych komrek VALUE. Przeszukiwanie takiej struktury jest o wiele szybsze, zajmuje ona te mniej miejsca w pamici &ndash; poniewa bloki RValue maj po 40 bajtw i wymagaj 1 bitu do sygnalizacji atwo wyliczy, e ostateczna bitmapa zajmuje okoo 1/(40*8) = 1/320 rozmiaru caej sterty.</p>

<p>Do czego sprowadza si najwikszy (moim zdaniem) problem Ruby&#8217;ego? Ot GC w MRI nie dysponuje opcj przenoszenia obiektw. Porwnujc do Mono wszystkie obiekty w Rubym traktowane s jako pinned object. Niesie to szereg nastpstw m.in. w przypadku koniecznoci alokacji duego obiektu na stercie o mocno sfragmentowanej strukturze, moe istnie potrzeba rozszerzenia rozmiaru sterty (a zatem zwikszenia zuycia RAMu w caym programie) pomimo, e istnieje dostateczna ilo miejsca, aby taki obiekt zaalokowa.</p>

<p>Czy mona zmieni GC w Rubym na taki, ktry zdolny jest przesuwa obiekty? Nie. Na drodze stoj tu referencje na obiekty, ktre wewntrz s w rzeczywistoci zwykymi wskanikami na bloki pamici bezporednio na stercie. Przesunicie obiektu na stercie wie si ze zmian jego adresu, poniewa jednak nie wiemy ile referencji (ktrych w algorytmie <em>mark&amp;sweep</em> nie zliczamy) naley powiadomi o nowej lokacji obiektu, taka operacja nie jest moliwa. Naturalnie mona to zmieni (np. wprowadzi wskaniki porednie), jednake spowoduje to dysonans midzy dotychczasowymi implementacjami wtyczek z jzyka C montowanych do Ruby&#8217;ego i zniszczy jego kompatybilno wstecz. Niestety sdz, e prdzej czy pniej ta decyzja musi zosta podjta.</p>

<h2>Kltwa jzykw dynamicznych</span></h2>

<p>Kolejnym krokiem w zrozumieniu problemu niskiej wydajnoci jest poznanie natury &ndash; i ceny &ndash; towarzyszcej jzykom dynamicznym. Wemy pod uwag nastpujcy przykad: zamy, e stworzylimy klas w dowolnym jzyku statycznie typowanym (np. Java lub C#). Jej posta jest nastpujca:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Point</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nie zagbiajc si zanadto w szczegy jestemy w stanie stwierdzi, e wywoanie konstruktora powinno zaowocowa stworzeniem w pamici obiektu zajmujcego 8 bajtw (2*sizeof(int)). Jak to wyglda w jzykach dynamicznie typowanych? Ot w Rubym MRI, Pythonie oraz JavaScriptcie (w niektrych przypadkach) tworzony obiekt jest de facto nie zwykym blokiem pamici lecz struktur budow bardziej przypominajc hash map/sownik, w ktrym kade pola reprezentowane jest przez string (js), hash (py) lub symbol reprezentowany w globalnej tablicy symboli (rb). Dotyczy to kadego pojedynczego obiektu. Wynika to w naturalny sposb z faktu, e tworzc obiekt danego typu, moemy go w dowolnej chwili rozszerzy o nowe pola bez zmiany struktury obiektw o tej samej klasie. Czas dostpu do pl w takich obiektach jest bardzo duy, za same struktury s o wiele wiksze ni ich odpowiedniki w jzykach statycznie typowanych.</p>

<p>Czy da si to omin? Tak, rozwizanie zostao ju wynalezione i zaimplementowane w JavaScriptcie na silnikach V8 (Chrome) oraz najnowszym SquirrelFish (Safari). Oba te silniki definiuj tzw. <em>hidden classes</em>. Idea ktra za nimi stoi wynika z prostej przesanki. Ot zauwaono, e nawet w jzykach dynamicznych wewntrzna struktura obiektw przez znaczn wikszo czasu pozostaje taka sama. Z tego powodu moemy reprezentowa obiekty o tej samej budowie przez ukryt klas &ndash; jej struktura pamici jest identyczna z t w jzykach statycznie typowanych. W momencie kiedy rozszerzamy dany obiekt o kolejne pola, tworzymy dla niego kolejn ukryt klas, o nowej, rozronitej budowie, a nastpnie realokujemy do nowej postaci. Z punktu widzenia wykonywanego programu jest to do rzadkie zjawisko, natomiast korzyci pynce z tego podejcia s ogromne.</p>

<h2>JIT, Interpreter oraz Tracing</h2>

<p>Ostatnia rnica, na ktrej chc si skupi dotyczy rnic wynikajcych z kompilatorw JIT (uywanych obecnie niemal we wszystkich najpopularniejszych jzykach: Javie, C# czy Pythonie na silniku PyPy) w stosunku do tradycyjnych interpreterw (Ruby MRI) oraz moliwoci jakich dostarczaj.</p>

<p>Podstawowa rnica midzy tymi dwoma typami polega na tym, e tradycyjny interpreter przetwarza i generuje kod maszynowy na bieco w czasie rzeczywistym, interpretujc skrypt linijka po linijce. JIT w tym czasie wykonuje mae wyprzedzenie, przetwarzajc cay dostpny kod jeszcze przed punktem jego wykonania.</p>

<p>Dodatkow korzyci pync z podejcia kompilacji JIT jest moliwo dynamicznej optymalizacji kodu w trakcie jego dziaania. Takie podejcie stosowane jest przez wszystkie najnowsze maszyny wirtualne. Jedna z takich technik znana jest jako <strong>trace trees</strong> i zostaa opisana <a href="http://www.ics.uci.edu/~franz/Site/pubs-pdf/ICS-TR-06-16.pdf">tutaj</a>. W duym skrcie ide tego podejcia jest wyapanie w aplikacji powtarzajcych si fragmentw kodu oraz zoptymalizowanie ich w taki sposb, aby wykonyway one jak najmniej instrukcji procesora. W jaki sposb jest to osigane?</p>

<ul>
<li><strong>Inlining </strong>&ndash; a wic ograniczenie liczby instrukcji call do zewntrznych funkcji poprzez skopiowanie ich zawartoci do wntrza ptli.</li>
<li><strong>Wnioskowanie typw</strong> &ndash; przykad: jeeli w jzyku dynamicznym dodajemy do siebie w ptli dwie&nbsp;wartoci typu int&nbsp;1000 razy, mamy przesanki aby twierdzi, e operacje wykonane na tej zmiennej zawsze bd dotyczy obiektu tego samego typu (gdyby nie to, musielibymy za kaym razem sprawdza czy operator dodawania nie zosta np. uyty raz dla <strong>int</strong>w a inny raz dla <strong>string</strong>w). Takie wnioski umoliwi nam wygenerowanie kodu maszynowego zoptymalizowanego do tego konkretnego typu &ndash; jest to bardzo przydatne z punktu widzenia Ruby&#8217;ego. Za przykad niech posuy metoda dodawania 2 liczb cakowitych &ndash; teoretycznie moliwa do wykonania w 1 instrukcji maszynowej, w Rubym jest opakowana w metod wirtualn, ktra dodatkowo definiuje sprawdzanie zakresu dla wynikowej liczby i w zalenoci od wyniku zwraca jedn z dwch wewntrznie rnych implementacji obiektu opakowujcego dany wynik</li>
<li><strong>Rekonstrukcja do postaci kodu maszynowego wykonywalnego na GPU</strong> &ndash; wykonywalne, o ile kompilator jest w stanie rozpozna stosowny kod na podstawie okrelonych wzorcw (z tego co wiem, maszyna wirtualna na FireFoxie potrafi co takiego).</li>
</ul>


<p>Rozwizania zostay ju wykorzystane na najnowszych VMach JavaScriptu. Niestety Ruby i Python wci czekaj na swoj kolej.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ustrukturyzowane repozytorium - Git Flow]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/03/16/ustrukturyzowane-repozytorium-git-flow/"/>
    <updated>2013-03-16T08:29:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/03/16/ustrukturyzowane-repozytorium-git-flow</id>
    <content type="html"><![CDATA[<p>O tym czym jest Git, wie chyba kady programista. O konwencjach i wzorcach stosowanych podczas produkcji do rozwoju repozytorium syszao jednak zdecydowanie mniej osb, za jeszcze mniej stosowao je w praktyce. W tym pocie postaram si poruszy ten temat w kontekcie <strong>git flow</strong> &ndash; narzdzia do integracji systemu kontroli wersji ze strategi procesu tworzenia oprogramowania.</p>

<p>Jaki czas temu Maciej Aniserowicz <a href="http://www.maciejaniserowicz.com/2012/12/10/sztuka-commitowania-pracy/">opisa na swoim blogu</a> kilka wasnych przemyle na temat konwencji stosowanych w celu poprawy pracy z systemem kontroli wersji. Mniej wicej wtedy zacz mi wita pomys podzielenia si swoimi spostrzeeniami na temat git flow &ndash; narzdzia, ktre miaem okazj pozna wczeniej podczas moich przygd jako programisty RoR. Teraz po dugich miesicach nareszcie zebraem si w sobie aby podzieli si swoimi dowiadczeniami.</p>

<h2>Czym jest git flow?</h2>

<p>W skrcie jest to nakadka do gita rozszerzajca go o zbir nowych komend umoliwiajcych nadanie temu systemowi kontroli wersji struktury zgodniej z workflowem wytwarzania oprogramowania. Pytanie: tylko jak wyglda ten workflow? Jego gwnym zaoeniem jest podzia repozytorium na kilka cile powizanych ze sob paszczyzn-gazi:</p>

<ul>
<li>ga developerska (domylnie: <em>develop</em>) &ndash; na niej nanoszone s biece zmiany commitowane przez programistw pomidzy wypuszczaniem kolejnych wersji programu.</li>
<li>ga produkcyjna (domylnie: <em>master</em>) &ndash; zawiera biec, najnowsz wersj programu.</li>
<li>gazie z wersjami (domylnie: <em>release-&lt;numer_wersji></em>) &ndash; po jednej na kad wydan wersj programu. Zmiany std trafiaj pniej bezporednio na ga produkcyjn.</li>
<li>gazie z nowymi funkcjonalnociami (domylnie: <em>feature-<nazwa></em>) &ndash; za kadym razem kiedy tworzymy nowy modu/funkcjonalno do projektu, tworzymy dla niego automatycznie jego wasn ga. Po zakoczeniu prac jest ona mergowana z branchem developerskim.</li>
<li>gazie z poprawkami (domylnie: <em>hotfix-<nazwa></em>) &ndash; poprawki mog by wykonywane zarwno z gazi produkcyjnej jak i developerskiej i tworzone s dla nich wasne odnogi. Po zacommitowaniu poprawki trafia ona do obu branchw (<em>master </em>oraz <em>develop</em>).</li>
<li>gazie wsparcia (domylnie: <em>support-&lt;numer_wersji></em>) &ndash; wprowadzona niedawno. Tutaj wykonywane s poprawki i zmiany na potrzeby klientw wykorzystujcych starsze wersje programu.</li>
</ul>


<p>Cao zostaa dokadniej &ndash; wraz z przykadami &ndash; przedstawiona <a href="http://vimeo.com/16018419">tutaj</a>. Na oficjalnym wiki projektu na githubie mona z kolei znale <a href="https://github.com/nvie/gitflow/wiki/Command-Line-Arguments">pen list nowych komend</a>. Pozwalaj one zautomatyzowa proces zarzdzania commitami/zadaniami na kadej z gazi.</p>

<h2>Jak zainstalowa git flow na Windows?</h2>

<p>Jest to w sumie dobre pytanie, poniewa domylnie narzdzie to byo tworzone na potrzeby spoecznoci Linuxa. Instalacja na systemie Windows jest odrobin bardziej skomplikowana, jednak w Internecie dostpne s poradniki poruszajce to zagadnienie &ndash; ja korzystaem z <a href="http://xinyustudio.wordpress.com/2012/03/26/installing-git-flow-in-windows/">tego</a> (z niewielkimi zmianami). Poniej opisz list krokw jak wykonaem, aby rozrusza git flow u siebie.</p>

<p>Zakadajc, e mamy ju zainstalowanego Gita i znamy ciek do niego, naley:</p>

<ul>
<li>Pobra <em>util-linux-ng</em> dla Windowsa. Mona to zrobi z <a href="http://gnuwin32.sourceforge.net/packages/util-linux-ng.htm">tej strony</a>. Wystarczy jednak, e z dziau Downloads pobierzemy tylko foldery <strong>Bin </strong>oraz <strong>Dependencies</strong>.</li>
<li>Skopiowa zawarto paczki <strong>Bin/bin</strong><strong> </strong>oraz <strong>Dependecies/bin/libintl3.dll</strong> do katalogu bin w ciece, w ktrej mamy zainstalowanego Gita.</li>
<li>Klonujemy repozytorium git flowa: <code>git clone -recursive git://github.com/nvie/gitflow.git</code></li>
<li>Na koniec musimy w zwykej systemowej konsoli wej do nowo sklonowanego folderu <strong>gitflow/contrib</strong> i wywoa komend: <code>msysgit-install.cmd &ldquo;&lt;cieka do Gita>&rdquo;</code></li>
</ul>


<p>Po wykonaniu tych krokw wszystkie komendy git flowa powinny by dostpne.</p>

<h2>Bonus dla ciekawskich</h2>

<p>Dla czci z czytelnikw moe by to nowo, ale git umoliwia nam definiowanie wasnych komend. Aby to wykona, naley utworzy wasny plik .exe, ktry bdzie definiowa nasz komend. Nazwa pliku jednoczenie okrela jego sposb wywoania, przkadowo plik <em>git-&lt;moja_komenda>.exe</em> bdzie mona wywoa za pomoc polecenia <code>git &lt;moja_komenda></code>. Zgodnie z przyjt zasad konstrukcji skryptw bashowych pierwsza linijka pliku powinna zawiera polecenie <code>#!/bin/sh</code>. Kolejne linie definiuj polecenia, ktre chcemy zawrze. Na koniec, aby plik by widziany z poziomu konsoli gita, naley go umieci w ciece <em>&lt;katalog_git>/libexec/git-core</em> &ndash; tam te moemy zobaczy definicje wszystkich dotychczas dostpnych komend.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Knockout.js - spostrzeenia]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/03/09/knockoutjs-spostrzezenia/"/>
    <updated>2013-03-09T12:25:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/03/09/knockoutjs-spostrzezenia</id>
    <content type="html"><![CDATA[<p>Poniewa z <a href="http://knockoutjs.com/">knockout.js</a> mam do czynienia od duszego czasu (dokadnie od wersji 1.0 ;) ), postanowiem podzieli si moimi spostrzeeniami ze tymi, ktrzy chc wykorzysta ten framework w swojej pracy, jak rwnie osobami ktre ju go stosuj oraz generalnie wszystkim zainteresowanym w pisaniu ustrukturyzowanych skryptw JS. Ale zacznijmy od pocztku.</p>

<h2>Czym jest Knockout.js?</h2>

<p>Jest to rozbudowany, javascriptowy framework MVVM umoliwiajcy tworzenie bogatych aplikacji internetowych. W przeciwiestwie do tradycyjnego podejcia tzn. bindowania ASP&#8217;owych modeli &ndash; po stronie serwera &ndash; za porednictwem tagw <code><input></code> osadzonych w formularzach HTML, umoliwia on nam odwzorowanie na identyczny obiekt JSON po stronie klienta. Pozwala te na dual-binding tego modelu z fragmentami strony wywietlanej uytkownikowi. Oznacza to, e kada zmiana wykonana na zbindowanym tagu htmlowym spowoduje natychmiastowe zaktualizowanie modelu zachowanego w przegldarce i vice versa &ndash; kada zmiana pola nalecego do obiektu spowoduje update na powizanych fragmentach strony. Wszystko to w czasie rzeczywistym, w deklaratywny sposb.</p>

<p>Tyle w kwestii definicji dla ludzi nie zaznajomionych z tym podejciem. Osoby lepiej zorientowane w zagadnieniach frontendowych aplikacji WWW zapewne znaj ju t bibliotek podobnie jak alternatywy wykorzystywane w tym rodowisku. Poniej postaram si przedstawi par wasnych przemyle na temat tej biblioteki, zaczynajc od tych zwizanych z sytuacjami, w ktrych warto jej uy, a kiedy lepiej sobie darowa.</p>

<p>Przypadki, kiedy powinnimy si wstrzyma z uyciem Knockout.js:</p>

<ul>
<li>Single Page Applications &ndash; wiem, e Microsoft promuje t bibliotek jako wasnego kandydata do roli frameworka SPA. Prawda jest jednak bolesna &ndash; Knockout nie posiada wbudowanych mechanizmw niezbdnych do tego typu zada. Mowa tu przede wszystkim o mechanizmie routingu/nawigacji pomidzy widokami oraz komunikacji z serwerem/metodach do zapisywania i synchronizacji danych. Nie znaczy to oczywicie, e budowa takich rozwiza jest niemoliwa. Uwaam po prostu, e w takich przypadkach lepiej skorzysta z innych bibliotek, lepiej przystosowanych do takich zada np. <a href="http://angularjs.org/">AngularJS</a>.</li>
<li>Standardowe widoki CRUD &ndash; jeeli planujesz budow standardowych ekranw, ktre nie musz zachowywa skomplikowanych zalenoci pomidzy obiektami-modelami, lub twoje widoki mapuj si z tabelami w bazie w relacjach 1 do 1, wtedy powiedzmy sobie jasno &ndash; Knockout jest tobie nie potrzebny. Nie wytaczaj dziaa na komara.</li>
<li>Szablony po stronie klienta &ndash; o ile mechanizm deklaratywnych zalenoci umoliwia wykorzystanie Knockouta do takich zastosowa, to w praktyce dodatkowy narzut zwizany z jego uyciem jest niewspmierny do korzyci. Jeeli nie potrzebujesz niczego ponad mechanizm szablonowania, proponuj zajrze na <a href="http://garann.github.com/template-chooser/">http://garann.github.com/template-chooser/</a>&ndash; ta strona pomoe ci ustali bibliotek waciw do twoich potrzeb.</li>
</ul>


<p>Kiedy Knockout moe ci si przyda:</p>

<ul>
<li>Prezentacja danych w modelu <a href="http://martinfowler.com/bliki/CQRS.html">CQRS</a> &ndash; a wic kiedy wymagania sprawiaj, e prosty CRUD z jQuery do ustawiania widocznoci elementw to za mao. Jeeli musisz na jednej stronie przedstawi skomplikowane relacje pomidzy obiektami-modelami, o wiele atwiej bdzie, jeeli zachowasz te zalenoci po stronie klienta.</li>
<li>Semi-SPA &ndash; czasami zdarza si, e aplikacja skada si z wielu prostych ekranw konfiguracyjnych, umoliwiajcych definiowanie rnych ustawie, oraz pojedynczych bogatych stron, ktre zawieraj skomplikowane mechanizmy wywietlania i manipulowania danymi. W takich przypadkach Knockout sprawdza si doskonale, poniewa upraszcza sterowanie logik takich widokw, za one same nie wymagaj stosowania mechanizmw, ktrych ta biblioteka nie zapewnia (a ktrych cz opisaem wyej).</li>
</ul>


<p>Mam przyjemno wykorzystywa ten framework rwnie na codzie w pracy od duszego czasu. Dziki temu udao mi si wykona kilka mniej lub bardziej oczywistych spostrzee na temat bdw popenianych przez programistw (w tym mnie ;) ) pracujcych z Knockoutem oraz wzrocem MV* w przegldarce, jak rwnie rad ktrych mgbym udzieli osobom ktre zaczynaj z nim swoj zabaw. Oto niektre z nich.</p>

<h2>Myl kategoriami aplikacji</h2>

<p>Jest to chyba najtrudniejsza lekcja. Nieraz logika wykonywana po stronie klienta siga setek &ndash; czasami tysicy &ndash; linii kodu, ktry dodatkowo moe zachowywa si rnie w zalenoci od tego, na jakiej przegldarce go odpalimy. Utrzymanie caoci jest trudne (nieodzowne jest tu credo: <em>it&rsquo;s fucking javascript</em>;) ), std te musisz nauczy si nadawa takim skryptom odpowiedni struktur. Bardzo przydaje si tutaj wiedza z zakresu budowy aplikacji desktopowych opartych o MVVM &ndash; Knockout ma z tym podejciem wiele wsplnego.</p>

<p>Podobnie jak w przypadku Single Page Applications oraz innych aplikacji opartych o MVVM powiniene z gry zastanowi si nad rozwizaniem kilku kwestii. Na &ldquo;lejszych&rdquo; stronach mog one pozosta do rozmyte, lecz wraz ze wzrostem bazy twojego kodu powinny one ulega coraz wyraniejszej separacji i wyspecjalizowaniu.</p>

<h2>Sposb komunikacji z serwerem</h2>

<p>Musisz okreli, w jaki sposb twoja aplikacja bdzie si komunikowa z serwerem. Czy bdzie to standardowy jQuery ajax, moe co bardziej zaawansowanego (np. <a href="http://amplifyjs.com/">Amplify.js</a>), a moe warunki pozwalaj na organizacj poczenia po WebSockets. Niezalenie od tego co wybierzesz, warto zastosowa kilka dobrych praktyk.</p>

<p>Po pierwsze nie zaszywaj kodu wywoa do serwera w sposb nierozerwalny. Przeka obiekt sucy do komunikacji z serwerem jako parametr do konstruktora ViewModelu, ktry takiej komunikacji wymaga. Nawet prosta konstrukcja typu</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">ViewModel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ajax</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">ajaxHandler</span> <span class="o">=</span> <span class="nx">ajax</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>sprawia, e w razie potrzeby bdziesz mg mniej bolenie wymieni ten obiekt na inny.</p>

<p>Kolejnym krokiem jest opakowanie uywanej biblioteki w obiekt-adapter &ndash; w ten sposb unikniesz trwaego wizania aplikacji z jednym frameworkiem. Bdziesz mia dowolno wyboru oraz prostego rozszerzenia uywanego rozwizania o metody/wzorce, ktrych faktycznie potrzebujesz. Bardzo wanym elementem tego podejcia jest rwnie moliwo trwaego opakowania wywoa do konkretnych adresw w bardziej przejrzyste i czytelne (oraz atwiejsze w przyszym rozwoju) metody. Sdz, e takie wywoanie:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">resource</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">Person</span><span class="p">);</span>  <span class="c1">// 0 twardych zalenoci</span>
</span></code></pre></td></tr></table></div></figure>


<p>jest prostsze z punktu widzenia przyszego rozwoju i prostoty debugowania kodu ni:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/some/url&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">model</span><span class="o">:</span><span class="nx">ko</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">Person</span><span class="p">)});</span> <span class="c1">// 2 twarde zalenoci: jQuery, knockout</span>
</span></code></pre></td></tr></table></div></figure>


<p>Wraz ze wzrostem wymaga dobr opcj jest dodanie do takiej komunikacji bardziej rozwinitych wzorcw typu Publish/Subscribe, ktre uatwi prac z kodem w przyszoci.</p>

<h2>Cykl ycia strony i obiektw</h2>

<p>Jest to dobra praktyka, poniewa mechanizm ten jest w Knockoutcie do ubogi. Warto jest przemyle, jakie typy zdarze mog okaza si przydatne w trakcie pracy ze stron. Czasem moesz potrzebowa podpi si z wasnymi funkcjami w konkretnych momentach ycia strony, np. tu przed/po wywoaniu polecenia bindowania danych (<code>ko.applyBindings</code>), czy te w momencie doczenia nowej waciwoci itp. Dobr praktyk jest te zdefiniowanie funkcji-inicjalizatora dla caego mechanizmu Knockouta oraz funkcji, w ktrej moesz opisa ca potrzebn konfiguracj w jednym miejscu.</p>

<h2>View modele &ndash; portlety i kontener aplikacji</h2>

<p>Dobr rad na pocztek jest przygotowanie pojedyczego ViewModelu, ktry nie suy zasadniczo samemu przechowywaniu obserwowanych waciwoci, lecz peni rol kontenera lub gwnego obiektu aplikacji. Dlaczego? Po pierwsze Knockout zasadniczo nie umoliwia generowania wielu VMw-korzeni dla pojedyczej strony HTML. Po drugie, dziaa tutaj analogia do MVVM w aplikacjach desktopowych. Pojedyczy widok &ndash; stron prezentowan uytkownikowi &ndash; z reguy da si podzieli na szereg niezalenych fragmentw (portletw), z ktrych kady jest zarzdzany przez inny ViewModel. Zapewnia to waciw separacj bardziej zoonego problemu, co znacznie uatwia ogarnicie caej logiki znajdujcej si na stronie.</p>

<p>Moja rada &ndash; nawet kiedy nie planujesz nadzwyczaj bogatej logiki na stronie, stwrz co najmniej jeden view model penicy rol rdzenia. W nim zdefiniuj pozostae view modele, ktre bd suyy do bindowania waciwych danych. adna obserwowalna warto wysyana na serwer nie powinna by bezporednio powizana z korzeniem. Nie kosztuje to wiele pracy, a w stuacji, kiedy twoja strona w przyszoci bdzie ewoluowa i rozrasta si o kolejne podwidoki/portlety, dodanie kolejnych VMw nie bdzie stanowi problemu.</p>

<h2>Utrzymaj separacj Widokw od ViewModelu</h2>

<p>Czstym bdem popenianym na pocztku przez programistw zaczynajcych swoj przygod z Knockoutem, jest wykonywanie operacji na drzewie DOM wewntrz logiki ViewModeli. Jest to powany bd. Zastanw si: czy tworzc akcj kontrolera uywasz jej do generowania HTMLa, ktry potem osadzasz na stronie?</p>

<p>Modele MVVM i MVC nie bez powodu zapewniaj separacj pomidzy widokami, a pozostaymi elementami aplikacji. W przypadku Knockout.js rol widoku stanowi bezporednio strona HTML wzbogacona o atrybuty <strong>data-bind</strong>, wewntrz ktrych definiujemy podane wizania. Jeeli z kolei czujesz, e dostpne bindingi nie speniaj twoich potrzeb, pamitaj e zawsze moesz zdefiniowa wasne.</p>

<h2>Lune zalenoci pomidzy moduami w aplikacji</h2>

<p>Pamitaj, e zmodularyzowane aplikacje s atwiejsze zarwno w utrzymywaniu jak i pniejszym rozwoju. atwiej jest take je debugowa i testowa. Z punktu widzenia programisty Javascript wzorzec Dependency Injection ma jeszcze jedn zalet. Poniewa unikasz w ten sposb odwoywania si do funkcji globalnych umieszczonych w wyszych partiach scope chain (wicej dowiesz si <a href="http://www.slideshare.net/nzakas/speed-up-your-javascript">tutaj</a>), twoja aplikacja staje si odrobin szybsza.</p>

<p>Unikaj wywoywania w kodzie swoich funkcji/metod rnego typu obiektw globalnych takich jak window, document, czy te obiektw-moduw do innych bibliotek np. jQuery. Zamiast tego przekazuj je jako paramtery do obiektw, ktre je wykorzystuj.</p>

<p>Innym &ndash; na pewno wartociowym &ndash; wsparciem, ktre moe przyda si osobom nie przywykym do puapek jzykw dynamicznie typowanych, s jzyki kompilowane do Javascriptu, takie jak <a href="http://www.typescriptlang.org/" title="">TypeScript</a> czy <a href="http://www.dartlang.org/">Dart</a>.</p>

<h2>Testy</h2>

<p>Testy jednostkowe s przydatne w kadej wikszej aplikacji i logika po stronie klienta nie stanowi tutaj wyjtku. Im dalej rozwijasz swoj aplikacj i im wicej operacji wykonywanych jest w przegldarce uytkownika, tym bardziej prawdopodobne, e trafisz na moment w ktrym testy jednostkowe stan si nieocenione.</p>

<p>W tym celu naley przedtem zapewni &ldquo;testowalno&rdquo; swojego kodu. Wskazwki opisane przeze mnie powyej (zwaszcza te dotyczce modularyzacji i lunych powiza) dotycz rwnie tego zagadnienia. Mimo e Knockout nie zapewnia wbudowanych klas uatwiajcych testowanie (AngularJS jest pomocny rwnie pod tym wzgldem), nie jest to duym problemem, poniewa Javascript jest jzykiem bardzo elastycznym i rozszerzalnym, zatem pisanie mockw nie stanowi tutaj problemu.</p>

<p>Co do wyboru frameworka testowego jest to kwestia wasnych preferencji. Jedni wybior polecany przez M$ <a href="http://qunitjs.com/">QUnit</a> wspierajcy programowanie TDD. Dla programistw .Net jest to tradycyjna dobrze znana cieka. Inni (w tym ja ;) ) wol metodyk BDD i czytelno, jak oferuj biblioteki takie jak <a href="http://pivotal.github.com/jasmine/">Jasmine</a>. Dlaczego preferuj wanie to drugie podejcie? Dlatego e atwiej definiowa testy w kategoriach konkretnych zachowa, jakich oczekujemy po dziaaniu naszego kodu, ni operacji, ktre nie zawsze musz jasno definiowa to, co faktycznie chcemy osign.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript a wzorce projektowe]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/02/23/javascript-wzorce-projektowe/"/>
    <updated>2013-02-23T19:01:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/02/23/javascript-wzorce-projektowe</id>
    <content type="html"><![CDATA[<p>Zao si, e wiele osb czytajc ten tytu puknie si w gow. I owszem w wielu sytuacjach wzorce nie s niezbdne do tworzenia przejrzystych i dobrze rozwijalnych skryptw. Do czasu. Dokadnie do momentu gdy nasz skrypt zaczyna mie wicej ni kilkadziesit linijek.</p>

<p>W zalenoci od jzyka programowania, pisany przez nas kod moe mie mniejsz lub wiksz przejrzysto. Niektre jzyki takie jak Haskel, s z natury bardzo klarowne i skupiaj si na istocie rzeczy. Inne, jak wanie Javascript, daj programicie olbrzymie moliwo zrobienia czego na pierdyliard sposobw, co nie oznacza, e kady sposb jest poprawny. Jakby tego byo mao, javascriptowe JITy s wstanie przekn nawet bardzo niezdarny kod. Dlatego wanie dyscyplina samego programisty oraz stosowanie wzorcw jest tym bardziej istotne.</p>

<p>O tradycyjnych wzorcach &ndash; strategiach, obserwatorach etc. &ndash; napisano ca mas artykuw. Dlatego te poniej postaram si przedstawi kilka mniej znanych, skupiajc si szczeglnie na tych, ktre s istotne z punktu widzenia JS, przez wzgld na moliwoci jakie daje oraz brakujcych konstrukcji dostpnych w innych jzykach, ktrych tutaj brakuje &ndash; w gruncie rzeczy czym s wzorce projektowe, jeeli nie powszechnymi sposobami na obejcie brakw odpowiednich konstruktw w danym jzyku programowania?</p>

<h2>Funkcje natychmiastowe</h2>

<p>Mechanizm funkcji natychmiastowych (<strong>immediate functions</strong>) jest jedn z podstawowych sztuczek jzykowych wykorzystywanych w Javascriptcie. Poniewa wiedza ta stanowi fundament innych wzorcw, przedstawi go poniej.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">immediateValue</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// wykonujemy jak operacj i zwracamy wartos</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
</span><span class='line'>  <span class="p">})();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// okrelamy zewntrzne obiekty, ktre wywoujemy wewntrz funkcji</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">// wykonujemy jak operacj</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">module</span><span class="p">;</span>
</span><span class='line'><span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Jak widzimy cao polega na jednoczesnym zdefiniowaniu funkcji i jej wykonaniu. Jakie s zalety tego podejcia?:</p>

<ul>
<li>Moemy w ten sposb budowa moduy &ndash; poniewa zawarto funkcji powoduje stworzenie nowego zakresu (scope &ndash; chocia z tym ze wzgldw wydajnociowych nie naley przegina), wszystkie zmienne lokalne uyte w funkcji-module nie s widoczne spoza niej, dopki programista jawnie nie okreli inaczej.</li>
<li>Przekazujc parametry do takiej funkcji moemy jawnie okreli zalenoci pomidzy operacjami/obiektami uywanymi wewntrz funkcji ze wiatem zewntrznym.</li>
</ul>


<h2>Modularyzacja</h2>

<p>Jest to do czsto poruszany problem (sam nieraz o nim wspominaem), poniewa JS jako tako sam nie umoliwia definiowania pakietw ani przestrzeni nazw. Std te pierwszym zaprezentowanym przeze mnie wzorcem bdzie <strong>namespace</strong>. Poniewa przykadowy kod umieciem i opisaem w jednym z poprzednich <a href="http://horusiath.blogspot.com/2012/09/javascript-porady-i-uwagi.html">postw</a>, gwoli przypomnienia umieszcz tutaj przykadowy kod takiego rozwizania.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>      <span class="nx">parent</span><span class="p">[</span><span class="nx">module</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">parent</span><span class="p">[</span><span class="nx">module</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
</span><span class='line'>      <span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">[</span><span class="nx">module</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">parent</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Cache&#8217;owanie funkcji</h2>

<p>Ze wzgldu na silniki starszych przegldarek i ch ograniczenia skomplikowanych operacji wiele bibliotek oferuje mniej lub bardziej wyrafinowane mechanizmy suce cache&#8217;owaniu danych. Javascript przychodzi tutaj z pomoc, pozwalajc na zastosowanie tej techniki niemal dla dowolnej funkcji. Mowa tutaj o wzorcu <strong>memoization</strong>. Wykorzystuje on dwa podstawowe fakty dotyczce tego jzyka:</p>

<ol>
<li>Kada funkcja jest jednoczenie penoprawnym obiektem.</li>
<li>Kady obiekt moe peni funkcje sownika &ndash; a co za tym idzie mona wykorzysta go do dynamicznego przydzielania nowych waciwoci i hashy.</li>
</ol>


<p>Poniszy kod przedstawia najprostsz implementacj tego zachowania:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">memoizedFunction</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// parametr {value} stanowi jednoczenie klucz w naszym cache&#39;u</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">// sprawdzmy, czy parametr zosta wczeniej zapamitany</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">_cache</span><span class="p">[</span><span class="nx">value</span><span class="p">]){</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">_cache</span><span class="p">[</span><span class="nx">value</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>          <span class="c1">// zapamitywanie wywoania funkcji</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">fn</span><span class="p">.</span><span class="nx">_cache</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">fn</span><span class="p">.</span><span class="nx">_cache</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">fn</span><span class="p">;</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Naley zwrci uwag na fakt, e parametr przekazywany do funkcji w tej implementacji stanowi jednoczenie warto cache&#8217;owanego klucza, a sam wzorzec musi implementowa funkcje deteministyczne (tzn. takie ktre dla tego samego parametru wejciowego zwracaj zawsze t sam warto/wykonuj t sam operacje). Std te dobrze, jeeli maksymalna moliwa liczba przekazywanych parametrw jest znana &ndash; w sytuacjach skrajnych mogoby doj do tego, e cache zaczby zajmowa ogromn ilo pamici. W takim wypadku trzeba dodatkowo zaimplementowa dodatkowo mechanizm odmiecania lub okresowego czyszczenia cache&#8217;u.</p>

<p>Prawidowe dziaanie funkcji w duej mierze zaley od typu przekazywanego parametru &ndash; ze wzgldu na to, e Javascript bywa do nieprzewidywalny, najlepiej jest trzyma si typw prostych: String, Number, Boolean. W praktyce jednak wszystko to jednak zaley od twojej znajomoci trickw i puapek tego jzyka.</p>

<p>Gdzie przydaje si powyszy wzorzec? Kilka przykadw:</p>

<ul>
<li>W wywoaniach do serwera np. jeeli dla podanego adresu URL zwracana warto jest staa, moemy uy go w postaci klucza i zapamita zwracan warto. W ten sposb zmniejszymy czas i ilo requestw na serwer potrzebnych do skoczenia danej operacji.</li>
<li>Inne funkcje o staych kluczach, ale jednoczenie wykonujce zoone obliczenia np. w mechanizmach bindowania danych do modelu DOM przegldarki.</li>
</ul>


<h2>Dependency Injection</h2>

<p>Pojcie to jest ostatnio do czsto uywane, rwnie ze wzgldu na rosnc popularno frameworkw MVC. W Javascriptcie zostao ono uyte po raz pierwszy w duej skali wraz z nadejciem <a href="http://angularjs.org/">AngularJS</a>. Jednake, jeeli chcielibymy, moemy zaimplementowa kontener <strong>Inversion of Control</strong> dla wasnych potrzeb.</p>

<p>W pierwszej kolejnoci zdefiniujmy kontener IoC.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// kontener IoC</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">DependencyResolver</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
</span><span class='line'>  <span class="c1">// regex uyty do wycigania nazw zalenoci z konstruktora</span>
</span><span class='line'>  <span class="nx">ARG_REGEX</span> <span class="o">=</span> <span class="sr">/^function\s*[^\(]*\(\s*([^\)]*)\)/m</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">dependencies</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// funkcja rejestrujca typ w kontenerze</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">type</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">dependencies</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// zwraca instancj obiektu identyfikowanego po podanym kluczu </span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">){</span> <span class="p">...</span> <span class="p">};</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// rozwizujemy podane zalenoci podane w postaci listy kluczy</span>
</span><span class='line'>  <span class="c1">// dla dependency resolvera do postaci tablicy gotowych obiektw</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">resolveDependencies</span><span class="p">(</span><span class="nx">args</span><span class="p">){</span> <span class="p">...</span> <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>&ldquo;Klasa&rdquo; ta udostpnia dwie metody:</p>

<ul>
<li><code>register(key, type)</code> &ndash; rejestruje podan warto/funkcj konstruktora pod podanym kluczem.</li>
<li><code>resolve(key)</code> &ndash; tworzy typ zgodnie z zarejestrowan wczeniej nazw.</li>
</ul>


<p>Niestety javascript nie przechowuje informacji na temat typw parametrw pobieranych przez funkcj. Std te twrcy AngularJS postanowili zbudowa nastpujc konwencj &ndash; w momencie, gdy przy prbie utworzenia obiektu pojawiaja si problem z okreleniem typu argumentw przekazywanych do konstruktora, przyjmuje si, e nazwy parametrw s kluczami dla wartosci zarejestrowanych w kontenerze IoC. Jak to wyglda w praktyce? Ilustruje to nastpujcy kod:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// budujemy kontener</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DependencyResolver</span><span class="p">();</span>
</span><span class='line'><span class="nx">resolver</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;valueA&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// rejestrujemy 1 dla klucza &#39;valueA&#39;</span>
</span><span class='line'><span class="nx">resolver</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;valueB&#39;</span><span class="p">,</span> <span class="nx">MyClass1</span><span class="p">);</span> <span class="c1">// rejestrujemy &quot;klas&quot; dla klucza &#39;valueB&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// tworzymy now &quot;klas&quot; i rejestrujemy j jako &#39;valueC&#39;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">MyClass2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">valueA</span><span class="p">,</span> <span class="nx">valueB</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// kontener wygeneruje opowiednie wartosci sugerujc si nazwami parametrw</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">resolver</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;valueC&#39;</span><span class="p">,</span> <span class="nx">MyClass2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// tworzymy obiekt</span>
</span><span class='line'><span class="nx">resolver</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;valueC&#39;</span><span class="p">);</span> <span class="c1">// profit ;)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ciao metody resolve przedstawia si w takim wypadku nastpujco:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">dependencies</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// jeeli zarejestrowany typ jest funkcj/konstruktorem</span>
</span><span class='line'>  <span class="c1">// musimy rozwiza list parametrw podanych do dokonstruktora</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">){</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// wycigamy list wartoci przyjmowanych przez konstruktor</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">ARG_REGEX</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">toString</span><span class="p">())[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// zamieniamy je na waciwe obiekty</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">resolvedArgs</span> <span class="o">=</span> <span class="nx">resolveDependencies</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c1">// tworzymy now instancj danego typu</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">type</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">type</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">resolvedArgs</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// jeeli typ jest typem prostym wystarczy go zwrci</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">type</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Natomiast brakujce ciao metody resolveDependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">resolveDependencies</span><span class="p">(</span><span class="nx">args</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">resolvedArgs</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">dependency</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">trim</span><span class="p">();</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">dependency</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">){</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">resolved</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">dependency</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">resolvedArgs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">resolved</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">resolvedArgs</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Oczywicie powyszy kod nie okrela kwestii czasu ycia obiektu, ktr kontenery IoC przewanie rozwizuj. Jednake jaki problem tkwi w powyszym rozwizaniu? Ot w momencie minimalizacji danego skryptu caa nasza wiedza o nazewnictwie parametrw funkcji znika (zostaj one zastpione krtkimi &ndash; z reguy jednoliterowymi aliasami). Niestety ale nie da si tego rozwiza w elegancki sposb. W przypadku AngularJS zdefiniowana zostaa specjalna waciwo $inject, ktr dodajemy wasnorcznie do danej klasy, a ktra definiuje tablic kluczy-parametrw, dziki ktrym moliwe jest rozwizanie zalenoci przez kontener. W takim wypadku w powyszej implementacji wystarczy doda drobne usprawnienie:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">){</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">||</span> <span class="nx">ARG_REGEX</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">toString</span><span class="p">())[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>, natomiast, w samej zdefiniowanej klasie:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">valueA</span><span class="p">,</span> <span class="nx">valueB</span><span class="p">){</span> <span class="p">...</span> <span class="p">}</span>
</span><span class='line'><span class="nx">MyClass</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;valueA&#39;</span><span class="p">,</span> <span class="s1">&#39;valueB&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dlaczego ten mechanizm si przydaje? Odpowied jest dokadnie taka sama jak w przypadku DI po stronie serwera: modularyzacja projektu, spjny sposb i kontrola nad konstrukcj obiektw. Cao jest wprost nieoceniona, kiedy po stronie klienta wykonywany jest bardziej zaawansowany wycinek logiki. A do tego te wsparcie dla testw jednostkowych.</p>

<p>P.S.: Jestem zdania, e w kadym projekcie z wiksz iloci Javascriptu testy jednostkowe s nieocenione. Po pierwsze w tym jzyku wyjtkowo atwo o bdy i niezdarny kod, a TDD oraz BDD rozwizuj oba te problemy. Po drugie jestemy po stronie klienta. Chcesz sprawdzi czy logika do kontrolek User Interface i wywietlanie strony dziaa prawidowo? Gratulacje &ndash; jeste po waciwej stronie kabla.</p>

<h2>Dziedziczenie</h2>

<p>Pomimo, e Javascript jest jzykiem obiektowym, nie definiuje jednak mechanizmu dziedziczenia w sposb znany nam z innych jzykw. Na szczcie jego moliwoci pozwalaj nam na wykonanie takiego mechanizmu w postaci wzorca <strong>extend</strong> (<em>powered by CoffeScript ;)</em> ).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">childPrototype</span><span class="p">,</span> <span class="nx">superPrototype</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">// dziedziczenie skadowych</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">property</span> <span class="k">in</span> <span class="nx">superPrototype</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">// iterujemy po wszystkich skadowych rodzica</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">superPrototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">property</span><span class="p">)){</span>
</span><span class='line'>          <span class="nx">childPrototype</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">superPrototype</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// dziedziczenie konstruktora</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">ctor</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">childPrototype</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">ctor</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">superPrototype</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">childPrototype</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctor</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// definiujemy dostp do &quot;klasy bazowej&quot;</span>
</span><span class='line'>  <span class="nx">childPrototype</span><span class="p">.</span><span class="nx">__super__</span> <span class="o">=</span> <span class="nx">superPrototype</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">childPrototype</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Niestety, jeeli chcemy mie dostp do &ldquo;wirtualizacji&rdquo; metod w klasach pochodnych, musimy to wykonywa w do krzywy sposb. Przykad poniej.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// klasa bazowa</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Parent</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">Parent</span><span class="p">(</span><span class="nx">firstName</span><span class="p">){</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">firstName</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// definiujemy &quot;wirtualn&quot; metod</span>
</span><span class='line'>  <span class="nx">Parent</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="s2">&quot;Base: &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">firstName</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">Parent</span><span class="p">;</span>
</span><span class='line'><span class="p">})();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// klasa pochodna</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Child</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">BaseType</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">extend</span><span class="p">(</span><span class="nx">Child</span><span class="p">,</span> <span class="nx">BaseType</span><span class="p">);</span> <span class="c1">// okrelamy warunki dziedziczenia</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">function</span> <span class="nx">Child</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">// wywoujemy konstruktor z klasy bazowej</span>
</span><span class='line'>      <span class="nx">Child</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">firstName</span><span class="p">);</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">lastName</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// &quot;nadpisujemy&quot; metod z klasy bazowej</span>
</span><span class='line'>  <span class="nx">Child</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="c1">// wewntrz nadpisanej metody wywoujemy jej bazow posta</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">baseMessage</span> <span class="o">=</span> <span class="nx">Child</span><span class="p">.</span><span class="nx">__super__</span><span class="p">.</span><span class="nx">show</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="s2">&quot;Inherited: &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">+</span> <span class="s2">&quot; with &quot;</span> <span class="o">+</span> <span class="nx">baseMessage</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">Child</span><span class="p">;</span>
</span><span class='line'><span class="p">})(</span><span class="nx">Parent</span><span class="p">);</span> <span class="c1">// przekazujemy klas bazow mechanizmem funkcji natychmiastowej</span>
</span></code></pre></td></tr></table></div></figure>


<p>Jak wida, nie jest to technika przejrzysta, gwnie ze wzgldu na obejcia, jakie trzeba wykona, aby uzyska dostp do wywoa metod nadpisywanych z klas bazowych.</p>

<p>Kiedy jest to przydatne? Szczerze umieciem to jako ciekawostk, poniewa o ile o korzyciach dziedziczenia i wirtualizacji wie chyba kady, kto mia do czynienia z programowaniem obiektowym, to forma, w jakiej jest to podane w Javascriptcie moe okaza si cika do przeknicia. Z tego powodu polecam tutaj jzyki kompilowane do Javascriptu np. CoffeeScript lub TypeScript, ktre rozwizuj ten problem za nas.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nowe technologie - tak czy nie?]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/02/19/nowe-technologie-tak-czy-nie/"/>
    <updated>2013-02-19T18:54:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/02/19/nowe-technologie-tak-czy-nie</id>
    <content type="html"><![CDATA[<p>Jedn z ciekawszych cech web developerki jest mnogo dostpnych na tym polu rozwiza i technologii. Dlaczego uwaam, e to dobrze? Poniekd dlatego, e w ten sposb programista moe przezwyciy spadek motywacji i nud zwizan z wykonywaniem kolejnego <em>wielkiego projektu w modym, dynamicznym zespole</em>. Stwarza rwnie pole do popisu i cigego rozwoju, pokazuje rne sposoby na zrobienie tego samego lepiej i szybciej.</p>

<p>Niestety z punktu widzenia osb odpowiedzialnych za dostarczenie projektu klientowi nowa technologia w projekcie to nieprzewidywalna zmienna. Kierownik projektu otrzymujc propozycj wykorzystania czego nowego musi wzi pod uwag wiele niewiadomych. Kilka z tych ktre wpady mi do gowy to:</div><div><ul><li>Czy w ogle tego potrzebujemy?</li><li>Czy jest to dobrze udokumentowane? O jak dojrzaym projekcie mwimy? Jak wyglda sprawa ze wsparciem ze strony spoecznoci, producenta etc.?</li><li>Czy twrca nie porzuci wsparcia dla biecej wersji zostawiajc nas na lodzie?</li><li>Ile czasu zajmie teamowi przyswojenie tej technologii? A skoro ju j ma pozna, to czy bdziemy mogli wykorzysta t wiedz w innych projektach?</li><li>Jak wykorzystanie tej technologii wpynie na opnienie/przyspieszenie wykonania projektu na etapie startowym, gwnym, czy kocowym?</li><li>Jak wpynie to na wzrost/spadek kocowego kosztu projektu, koszt jego utrzymania i modernizacji?</li></ul><div>&nbsp; &nbsp; Kady z tych czynnikw moe pomc w osigniciu kocowego efektu, stworzy aplikacj szybciej, poprawi jej wydajno, zwikszy stopie modularnoci kodu, a przez to pomc w jego pniejszym rozwoju. Z drugiej strony zastosowanie (lub nieumiejtne zastosowanie) danego frameworka moe odbi si echem w kadej fazie ycia projektu, tym goniejszym im duej on bdzie budowany, rozwijany i eksploatowany przez klienta.</p>

<p>Nie znaczy to jednak, e powinnimy si wystrzega nowoci. Wrcz przeciwnie. Jest to swego rodzaju inwestycja, ktra przy pewnym wkadzie (tzw. &ldquo;prg wejcia&rdquo;) nieraz procentuje w przyszoci. W jaki sposb dobiera jednak technologie, eby w dalszej perspektywie czasu zwrciy si one w naszym projekcie? Postanowiem spisa swoje spostrzeenia na ten temat.</p>

<h2>Nie za wiele na raz</h2>

<p>Podchodzc do nowego projektu nie raz chciaoby si da ponie entuzjazmowi i zacz go z caym stosem nowych bibliotek, czekajcych na poznanie. Problem pojawia si, jeeli rzeczywicie przegniemy. Przypomina to wtedy ruszanie samochodem bezporednio z 5 biegu. Mija miesic, dwa, trzy, a mimo wysikw caego teamu robota stoi w miejscu. W efekcie morale pada pysk. To wanie efekt skumulowanego okresu wdraania si w nowe technologie.</p>

<p>Wdraanie kolejnych nowoci powinno wchodzi z rozwag (najlepiej pojedynczo lub niewielkimi grupkami &ndash; wci moliwe jest dodawanie nowych rzeczy w trakcie rozwijania projektu), tak abymy nie stracili sprzed oczu ostatecznego celu naszej pracy. Prawda jest gorzka: u podstaw nie chodzi przecie o nasz nauk i samorozwj lecz o to, aby dostarczy klientowi to czego potrzebuje.</p>

<h2>Kiedy warto?</h2>

<p>To dobre pytanie. Kiedy powinnimy wprowadza nowy framework do naszej domeny pracy? Opcji, ktre trzeba rozway jest wiele. Oprcz standardowych za i przeciw np. kwestie wydajnociowe, koszty eksploatacji czy przyspieszenie produkcji, uwzgldnibym rwnie:</p>

<ul>
<li>&ldquo;Prg wejcia&rdquo; w nowy framework &ndash; jest to jedno z zasadniczych zagadnie do rozwizania na samym starcie. Jeeli prg jest may, prawdopodobnie bdziemy mogli szybko skoczy z nauk i przej do waciwego wykorzystywania go w naszej aplikacji. Co jednak kiedy jest on duy? Tutaj warto wzi pod uwag kilka zmiennych:

<ul>
<li>Czas trwania projektu &ndash; jeeli projekt bdzie rozwijany latami, to nawet stosunkowo trudna w opanowaniu technologia nie wytworzy duego dugu czasowego.</li>
<li>Czstotliwo zmian w zespole &ndash; jak wiadomo, zesp nie zawsze jest kwesti sta i nieraz moe si zdarzy, e kolejni czonkowie bd przychodzi i odchodzi, zanim na dobre wdro si w nowe technologie. Dotyczy to rwnie pniejszego utrzymywania projektu. W takim wypadku dugi okres nauki rwnie dziaa na nasz niekorzy.</li>
<li>&ldquo;Reuywalno&rdquo; zdobytej wiedzy &ndash; czy poznana technologia bdzie moga by uyta pniej w innych projektach. Odpowied twierdzca pozwala to zredukowa sprzeciw zwizany z argumentami zawartymi w poprzednim punkcie.</li>
</ul>
</li>
<li>&ldquo;Prg wyjcia&rdquo; z aplikacji &ndash; fakt, e z sukcesem wprowadzilimy now bibliotek do projektu to nie koniec naszych zmaga. Budowa aplikacji z reguy wie si z faktem, e wymagania klienta zmieniaj si dynamicznie w czasie. Przypomina to gr w szachy, w ktrej nie widzimy caej szachownicy. Z tego powodu rozwaenie wszystkich dziaa na kilka ruchw do przodu moe sprawia problem. Moe si okaza, e w zaawansowanym stadium prac nad projektem klient yczy sobie nowej funkcjonalnoci lub zmiany istniejcej w sposb, ktry jest poza moliwociami naszej wspaniaej, nowo dodanej biblioteki. Z tego powodu w lepszej pozycji stoj rozwizania kompleksowe, pozwalajce programicie na dodawanie wasnych pluginw, moduw oraz udostpniajce otwarty kod.</li>
<li>Zaangaowanie zespou- a wic czy kto w ogle wykazuje chci do poznania nowinek czy raczej woli trzyma si starych, znanych rozwiza. Czy s chtni poznawa j we wasnym zakresie? Jest to gwnie pytanie z kategorii: czy masz przyjemo pracowa w <em>nerd teamie</em>? Trudno jest dodawa co nowego, jeeli bdziesz jedyn osob, ktra zamierza z tego korzysta.</li>
<li>Popularno &ndash; jak wiadomo im lepiej opisany w Internecie jest dany framework, tym lepiej dla potencjalnego developera. Fakt, e duo osb korzysta z danego rozwizania zwiksza szanse, e w razie problemw bdziemy mogli znale na nie odpowied zanim sami bdziemy musieli zada pytanie.</li>
<li>Wsparcie producenta &ndash; rwnie support dla danej biblioteki ma tu znaczenie. W sytuacji kiedy nie znalelimy rozwizania sami, a na forach rwnie nie ma nikogo kto do tej pory trafi na ten problem, pytanie do twrcw jest ostatni lub przed ostatni (jeeli mamy wgld w kod rdowy) rzecz jak moemy zrobi. Jak wiadomo w tej sytuacji najlepszy jest gwarantowany support (najczciej patny), niestety nawet on nie jest rzecz pewn &ndash; przykad: swego czasu natrafiem na bd kontrolki DevExpressa, ktry mimo, e znany od 2009r. jest zgoszony i opisany na oficjalnym forum wsparcia, do tej pory nie zosta rozwizany.</li>
</ul>


<h2>Wnioski</h2>

<p>Niestety kwestia inwestowania w nowe technologie to zoony problem. Mimo, e czsto jest to opacalne ryzyko, to czasem jednak niefortunny wybr moe okaza si prawdziw min, ktrej zarwno project manager (jako bezporednio odpowiedzialny za koszta i terminy), jaki i programici (jako ci, na ktrych spynie cae powstae w ten sposb gwno) w razie wybuchu wol unikn.</p>

<p>Wyjciem porednim s tutaj oczywicie pet-projekty &ndash; aplikacje semi-testowe i takie, ktre nigdy nie wychodz zasigiem poza wewntrzne systemy firmy, jednoczenie na tyle proste, aby suy za pole treningowe dla programistw.</p>

<p>Myl, e gwnym rozwizaniem jest tutaj umiejtno dostrzegania potencjalnych korzyci, szacowania ryzyka jak rwnie wzajemnego zrozumienia kadej ze stron nawzajem. W gruncie rzeczy jest to temat otwarty i mimo, e ostateczna decyzja z reguy zostaje w rkach pojedynczych osb, powinien on by rozwizywany poprzez otwart wymian pogldw (nawet w postaci 5-cio minutowej konferencji przez Skype) wszystkich osb zaangaowanych w proces wytwarzania oprogramowania.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ASP.NET a wydajno]]></title>
    <link href="http://bartoszsypytkowski.com/blog/2013/01/12/aspnet-wydajnosc/"/>
    <updated>2013-01-12T22:32:00+01:00</updated>
    <id>http://bartoszsypytkowski.com/blog/2013/01/12/aspnet-wydajnosc</id>
    <content type="html"><![CDATA[<p>Piszc aplikacje oparte o ASP.NET (+MVC) czsto korzystamy z wielu dodatkowych bibliotek/frameworkw usprawniajcych nasz prac. Czasem jednak zdarza si, e zatrzymujemy si zaczynamy zastanawia, jak cen musimy zapaci za wszystkie te dodatki? Poniej postaram si przedstawi list najczstszych problemw oraz najlepsze biblioteki suce ich wydajnemu rozwizaniu (uprzedzam, e wnioski mog by do zaskakujce ;) ).</p>

<h2>1. Object-Relational Mapping</h2>

<p>Na pierwszy ogie niech pjd frameworki ORM. Jak nie ciko si domyli pod wzgldem popularnoci triumfuje tutaj Entity Framework jako rozwizanie promowane przez MS, za odrobin z tyu wydaje si by NHibernate. Jak to jednak wyglda, jeeli wzilibymy pod uwag wydajno? Zaczynajc od bardzo popularnego zestawienia <a href="http://ormeter.net/">ORM Battle</a>:</p>

<ul>
<li><a href="http://dataobjects.net/">DataObjects.NET</a> mog poszczyci si najbardziej wydajn budow zapyta LINQ.</li>
<li><a href="http://bltoolkit.net/">Business Logic Toolkit</a> jest stawiany jako zwycizca w kwestii oglnej wydajnoci (operacje CRUD itp.).
-Pod wzgldem zapyta LINQ wydajnos <a href="http://nhforge.org/">NHibernate </a>jest skandaliczna &ndash; tutaj jednak naley si sowo wyjanienia, poniewa framework ten posiada wasny mechanizm generowania zapyta w locie (Criteria wraz z nakadk QueryOver), ktry oferuje znacznie lepsz wydajno oraz pozwala na wicej w stosunku do linq.</li>
</ul>


<p>Warto jednak zauway, e zestawienie to nie jest pene, brakuje w nim powiem kilku wanych bibliotek. Powoujc si na kolejny benchmark wykonany przez <a href="http://servicestack.net/benchmarks/">ServiceStack</a> (ta nazwa powtrzy si tutaj jeszcze przy kilku okazjach), wysnu mona kilka innych wnioskw:</p>

<ul>
<li>Narzut nakadany przez Entity Framework moe wyduy czas wykonania zapytania nawet 13-krotnie! &ndash; (zakadam, e dla bardziej zoonych zapyta ta rnica zmniejsza si na korzy EF) To ogromna przepa nawet biorc pod uwag <a href="http://noamlewis.wordpress.com/2012/07/18/net-4-5-improves-orm-performance-across-the-chart/">usprawnienia</a> naoone w .NET 4.5.</li>
<li>Zwycistwo wydajnoci naley do <a href="http://code.google.com/p/dapper-dot-net/">Dappera</a> &ndash; jest to microframework ORM stworzony przez Stackoverflow na potrzeby wysoko wydajnego dostpu do bazy danych, wykorzystywanego w tym serwisie. Tu za nim znalaz si z kolei <a href="https://github.com/ServiceStack/ServiceStack.OrmLite">ServiceStack.OrmLite</a> (naley jednak pamita, e s oni autorami tego benchmarku).</li>
</ul>


<p>Na czym wic polega sukces i droga do szybkoci? Myl, e gwn rol odgrywa tutaj prostota &ndash; zarwno EF jak i NHibernate oferuj rozbudowane interfejsy do budowy zapyta (LINQ i QueryOver), wasne jzyki porednie (NHibernate &ndash; HQL, Entity Framework &ndash; ESQL), mechanizmy zarzdzania obiektami itp. <strong>BLT</strong>, <strong>Dapper</strong> i <strong>OrmLite </strong>stosuj tutaj proste operacje z wykorzystaniem standardowych zapyta SQL, odrzucajc wysze warstwy abstrakcji i trzymajc si blisko podstawowych mechanizmw komunikacji z baz danych. Dodatkowo microframeworki obarczaj programist koniecznoci rcznego zarzdzania relacjami oraz synchronizacji stanu danych pomidzy encjami i baz. To z kolei przenosi dug wydajnociowy na kod napisany przez programist.</p>

<h2>2. Kontenery Inversion of Control</h2>

<p><em>Dependency Injection</em> to ju standard, mimo e wci nie jest to mechanizm domylny w ASP.NET. Zapewnienie lunych wiza okrelane jest jako dobra praktyka zarwno w MVC jak i MVVM (stosowanym przez liczne frameworki stosowane rwnie w aplikacjach desktopowych oraz na urzdzenia mobline). Opierajc si na kilku (<a href="http://www.palmmedia.de/blog/2011/8/30/ioc-container-benchmark-performance-comparison">1</a>, <a href="http://www.iocbattle.com/">2</a>, <a href="http://servicestack.net/benchmarks/#highcharts-8">3</a>, <a href="http://philipm.at/2011/0808/">4</a>) testach mona podj si zoenia kilku wnioskw:</p>

<ol>
<li><a href="http://www.ninject.org/">NInject</a> (ktry notabene jest cakiem popularnym rozwizaniem) wydajnociowo jest jednym z najsabszych i najwolniejszych kontenerw.</li>
<li>Biblioteki promowane przez Microsoft &ndash; <a href="http://mef.codeplex.com/">MEF</a> oraz <a href="http://unity.codeplex.com/">Unity</a> &ndash; rwnie nie prezentuj poraajcego poziomu. O ile Unity prezentuje si do dobrze, to wci stanowi do sab konkurencj dla innych rozwiza zawartych w zestawieniach.</li>
<li>Mimo tego, e powysze benchmarki nie zawsze si uzupeniaj, po odrobinie przeszukiwania sieci mona w zasadzie okreli, e wrd zwycizcw wydajnoci znajduj si: <a href="http://docs.structuremap.net/">StructureMap</a> oraz <a href="http://funq.codeplex.com/">Funq</a> (ktry z tego co mi wiadomo nie jest obecnie wspierany, co idzie zdecydowanie na jego niekorzy, jednak stanowi cz frameworka <em>ServiceStack</em>, jest rwnie dostpny w postaci open source).</li>
</ol>


<h2>3. Serializacja</h2>

<p>Serializacja obiektw to do szerokie zagadnienie, poniewa moemy mie na myli rne formaty (xml, json czy dane binarne), za kady z nich znajduje zastosowanie w innych sytuacjach i ma inn specyfik. Opierajc si na rnych rdach (<a href="http://www.servicestack.net/benchmarks/NorthwindDatabaseRowsSerialization.100000-times.2010-08-17.html">1</a>, <a href="http://servicestack.net/benchmarks/#highcharts-6">2</a>), mona pokusi si o kilka stwierdze:</p>

<ul>
<li>Jeeli chodzi o rozmiar zajmowany przez serializowane obiekty, najwydajniejszym rozwizaniem wydawa by si moga serializacja binarna. Jest to prosty i do logiczny wniosek, jednak okazuje si, e na tym polu rwnie istnieje pewna konkurencja (m.in ze strony formatu json), za wbudowane w .NET formatery i serializatory wcale nie s najwydajniejszym, co platforma ta moe zaoferowa.</li>
<li>Palma pierwszestwa naley si <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> (protok wymylony przez Google oraz stosowany do komunikacji pomidzy wewntrznymi usugami giganta z Mountain View) oraz ich .NET-owym bindingom: totalne zwycistwo zarwno pod wzgldem rozmiaru serializowanego obiektu, jak i czasie serializacji/deserializacji. Biblioteka ta, ma jeszcze jedn przewag &ndash; mimo, e wyjciowym formatem jest format binarny to w przeciwiestwie do domylnych rozwiza .NET protok ten nie jest powizany z jedn platform i moe suy do komunikacji z usugami napisanymi w innych jzykach programowania.</li>
<li>W kwestii serializacji JSON:

<ul>
<li>Serializery wbudowane we framework .NET nale do najwolniejszych rozwiza dostpnych na rynku &ndash; jest to tym bardziej przykre, e stanowi one domyln metod serializacji zawart w kontrolerach ASP MVC.</li>
<li><a href="http://james.newtonking.com/projects/json-net.aspx">JSON.NET</a> (najpopularniejsza alternatywa dla wbudowanych serializatorw, uywana m.in. w najnowszym WebAPI) mimo, e o jest wiele lepszy standardowych rozwiza, rwnie nie poraa swoimi osigami</li>
<li>Zwycizc pozostaje <a href="http://www.servicestack.net/docs/text-serializers/json-serializer">ServiceStack</a> (ponownie ;) ). 2-3x wiksza szybko ni konkurencyjny Json.NET i jeszcze wiksza przewaga nad rozwizaniami domylnymi.</li>
</ul>
</li>
</ul>


<h2>4. Client-side MVC/MVVM</h2>

<p>W <a href="http://horusiath.blogspot.com/2012/06/krotki-przeglad-po-frameworkach-mvc-w.html">jednym z poprzednich wpisw</a> opisaem kilka popularnych frameworkw javascriptowych stosowanych do prezentacji i zarzdzania logik po stronie przegldarki. Ocena moliwoci i szybkoci tych platform naley do szczeglnie trudnych. W internecie da si znale kilka stron pozwalajcych na przyjenie si bliej i ocenieni wydajnoci na wasne oczy (polecam <a href="http://stackoverflow.com/questions/12955337/angular-js-backbone-js-and-other-mv-patterned-js-libraries">ten wpis</a>).</p>

<ul>
<li><a href="http://backbonejs.org/">Backbone</a> jest wydajny, jednak naley tu wzi pod uwag fakt, e nie zapewnia adnego typu bindingu midzy widokiem a modelem, w dodatku wymaga od uytkownika rcznego manipulowania drzewem DOM &ndash; to z kolei stawia go w innej klasie problemw i w zasadzie ciko go porwnywa z frameworkami umoliwiajcymi wizania danych.</li>
<li>Generalnie rzecz biorc <a href="http://angularjs.org/">AngularJS</a> ma lepsz wydajno do <a href="http://knockoutjs.com/">Knockouta</a>. Jednak ta tendencja zmienia si wraz ze wzrostem liczy wiza tzn. im wiksza tym bardziej Knockout wysuwa si na prowadzenie. W tym wypadku jednak duy wpyw na wynik kocowy ma sama budowa kontrolerw w AngularJS (dla lepszej wydajnoci powinny by one mae i nie zawiera zbyt duej iloci powiza ani skomplikowanej logiki obliczeniowej, ktra powinna by wykonywana osobno przez mechanizm serwisw dostpny we frameworku).</li>
</ul>


<h2>5. Templating Engines</h2>

<p>Du rnic robi rwnie wykorzystanie silnikw do generowania szablonw stron WWW (od kiedy wikszo ze stron generowana jest w sposb dynamiczny). Tutaj jednak rozbijemy problem na 2 czci:</p>

<ol>
<li>Silniki po stronie serwera &ndash; Na stackoverflow mona znale <a href="http://stackoverflow.com/questions/1451319/asp-net-mvc-view-engine-comparison">wtek</a>, ktry przedstawia krtk charakterystyk okoo 12 rnych silnikw wykorzystywanych do generowania stron po stronie serwera. Niestety, nie udao mi si znale podobnego zestawienia jeeli chodzi o kwestie wydajnociowe. Zamiast tego postaram si przedstawi kilka dobrych rad dotyczcych kwestii wydajnociowych dotyczcych dwch domylnych silnikw .NET, Aspx i Razor:

<ul>
<li>W wikszoci przypadkw Aspx dziaa lepiej ni porwnywalny kod w Razorze (zwaszcza w porwnianiu z pierwsz wersj) &ndash; rnica ta wynosi przewanie od 50% do 12% na korzy aspx. Tutaj jednak wiele zaley od zmiany ustawie domylnych, cacheowania elementw strony itp.</li>
<li>W przypadku kiedy nie wykorzystujesz obu tych silnikw, usu ten ktrego nie uywasz. W wielu przypadkach przyspiesza to dziaanie aplikacji, m.in. przez to, e w prosty sposb skraca ilo przeszukiwanych szablonw w katalogu <em>Views</em> aplikacji MVC o poow.</li>
<li>Porada dotyczca ViewState (WebForms) &ndash; nie potrzebujesz mechanizmu ViewState na stronie? Wycz go. Potrzebujesz go? Zastanw si czy na pewno, zrb obejcie, a potem go wycz. Serio. Mechanizm ten jest powszechnie uznawany za jedno z najwikszych nieporozumie w wiecie aplikacji webowych.</li>
</ul>
</li>
<li>Silniki po stronie klienta &ndash; Budowa penego stosu MVC po stronie klienta nie jest jedynym sposobem na budow dobrze zorganizowanego mechanizmu zarzdzania widokami. W wielu przypadkach moliwe jest wykorzystanie prostego silnika wykorzystujcego szablony do generowania widokw w bezporednio przez przegldark. Mechanizm tak stosowany jest m.in. przez LinkedIn, jak rwnie Twittera, ktry udostpni swj silnik <a href="http://twitter.github.com/hogan.js/">Hogan.js</a> jako projekt open source. Dobry test wydajnoci rozmaitych silnikw zaprezentowano na <a href="http://jsperf.com/dom-vs-innerhtml-based-templating/112">tej stronie</a>.</li>
</ol>


<p>W wikszoci takich porwna korona wydajnoci naley do <a href="http://olado.github.com/doT/index.html">doT.js</a>. Jedn z przyjemnych rzeczy w tej bibliotece, jest moliwo okrelania, ktre elementy szablonu bd generowane w czasie kompilacji (po wykonaniu kompilacji generowana jest funkcja kompilatora generujca wynikowy html na podstawie modelu przekazanego jako parametr &ndash; funkcja ta moe by cache&#8217;owana), a ktre z nich bd wykonywane w runtime.</p>

<h2>Podsumowanie</h2>

<p>Po analizie dostpnych rozwiza to co najbardziej mnie uderzyo, to fakt jak wiele z najpopularniejszych bibliotek prezentuje si zaskakujco enujco w testach dotyczcych wydajnoci. Za swoje mae odkrycie mog uzna z kolei stos zaoferowany przez ServiceStack, dla ktrych wydajno wydaje si priorytetem w kadej kategorii, w ktrej podjli si konkurowa. Niestety nie miaem do tej pory duo do czynienia z tym frameworkiem, co jednak bardzo przypado mi do gustu, to fakt e jest to rozwizanie kompletne, oferujce moliwo kompletnego zastpienia kadego moduu w tradycyjnym stosie ASP.NET MVC/WCF/EntityFramework swoim wasnym, spjnym zbiorem bibliotek. Do tego w caoci dziaajcym pod Mono na Linuxie.</p>
]]></content>
  </entry>
  
</feed>
